function obj(t){arguments.length>1&&alert("invalid use of obj with multiple params:"+t);var e=document.getElementById(t);return e||console.error("element not found: "+t),e}function transformToPrintable(t){for(var e in t){var n=t[e];"string"==typeof n&&(t[e]=(n+"").replace(/\n/g,"<br>"))}return t}function stopBubble(t){return t.stopPropagation(),t.preventDefault(),!1}function initialize(t,e,n){var r=t.asId(),a=$.Deferred();if(!__initedComponents[r])if(__initedComponents[r]=a,"CSS"==(e+"").toUpperCase()){var s=$("<link rel='stylesheet' type='text/css'>").prop("href",t);$("head").append(s),a.resolve()}else if("SCRIPT"==(e+"").toUpperCase())$.ajax({type:"GET",url:t+"?"+buildNumber,dataType:"script",cache:!0,success:function(){a.resolve()},error:function(){a.reject()}});else{t=t+(t.indexOf("?")>-1?"&":"?")+buildNumber;$.ajax({type:"GET",url:t,dataType:"html",cache:!0,success:function(t){n=n||$("body"),n.append(t),a.resolve()},error:function(){a.reject()}})}return __initedComponents[r].promise()}function registerEvent(t,e){$("body").off(t).on(t,e)}function openPersistentFile(t){var e=window.self;try{window.top!=window.self&&(e=window.top)}catch(t){}if(t.mime.indexOf("image")>=0){var n=$("<img>").prop("src",t.url).css({position:"absolute",top:"-10000px",left:"-10000px"}).one("load",function(){var t=$(this),n=t.width(),r=t.height(),a=n/r,s=.8*$(e).width(),i=.8*$(e).height();n>s&&(n=s,r=n/a),r>i&&(r=i,n=r*a);t.width(n).height(r).css({position:"static",top:0,left:0}),e.createModalPopup(n+100,r+100).append(t)});e.$("body").append(n)}else t.mime.indexOf("pdf")>=0?e.openBlackPopup(t.url,.8*$(e).width(),.8*$(e).height()):window.open(t.url+"&TREATASATTACH=yes")}function wrappedEvaluer(toEval){eval(toEval)}function evalInContext(t,e){wrappedEvaluer.apply(e,[t])}function objectSize(t){var e=1,n="bytes";return t>=1048576?(e=1048576,n="MB"):t>=1024&&(e=1024,n="KB"),1==e?t+" "+n:(t/e).toFixed(2)+" "+n}function htmlEncode(t){return $("<div/>").text(t).html()}function htmlLinearize(t,e){t=t.replace(/(\r\n|\n|\r)/gm,"").replace(/<br>/g," - "),t=t.replace(/-  -/g,"-");var n=$("<div/>").text(t).text();if(e){var r=n.length>e?"...":"";n=n.substring(0,e)+r}return n}function htmlDecode(t){return $("<div/>").html(t).text()}function createCookie(t,e,n){if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var a="; expires="+r.toGMTString()}else var a="";document.cookie=t+"="+e+a+"; path=/"}function readCookie(t){for(var e=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var a=n[r];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return null}function eraseCookie(t){createCookie(t,"",-1)}function getParameterByName(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=n.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}function canSubmitForm(t){return"object"!=typeof t&&(t=$("#"+t)),t.find(":input[required],:input[invalid=true]").isFullfilled()}function showSavingMessage(){$("#savingMessage:hidden").fadeIn(),$("body").addClass("waiting"),$(window).resize()}function hideSavingMessage(){$("#savingMessage:visible").fadeOut(),$("body").removeClass("waiting"),$(window).resize()}function isValidURL(t){return/^(([\w]+:)?\/\/)?(([\d\w]|%[a-fA-f\d]{2,2})+(:([\d\w]|%[a-fA-f\d]{2,2})+)?@)?([\d\w][-\d\w]{0,253}[\d\w]\.)+[\w]{2,4}(:[\d]+)?(\/([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&?([-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)?$/.test(t)}function isValidEmail(t){return/^.+@\S+\.\S+$/.test(t)}function isValidInteger(t){return reg=new RegExp("^[-+]{0,1}[0-9]*$"),reg.test(t)||isNumericExpression(t)}function isValidDouble(t){var e=Number.decimalSeparator;return reg=new RegExp("^[-+]{0,1}[0-9]*["+e+"]{0,1}[0-9]*$"),reg.test(t)||isNumericExpression(t)}function isValidTime(t){return!isNaN(millisFromHourMinute(t))}function isValidDurationDays(t){return!isNaN(daysFromString(t))}function isValidDurationMillis(t){return!isNaN(millisFromString(t))}function isNumericExpression(expr){try{var a=eval(expr);return"number"==typeof a}catch(t){return!1}}function getNumericExpression(expr){var ret;try{var a=eval(expr);"number"==typeof a&&(ret=a)}catch(t){}return ret}function isValidCurrency(t){for(var e="",n=Number.currencyFormat+"",r=!1,a=!1,s="",i="[0-9\\"+Number.groupingSeparator+"]+[\\"+Number.decimalSeparator+"]?[0-9]*",o=0;o<n.length;o++){var l=n.charAt(o);"."==l||","==l||"0"==l?""!=s&&(e=e+"(?:"+RegExp.quote(s)+")?",s=""):"#"==l?(""!=s&&(e=e+"(?:"+RegExp.quote(s)+")?",s=""),a||(a=!0,e+=i)):"-"==l?(""!=s&&(e=e+"(?:"+RegExp.quote(s)+")?",s=""),r||(r=!0,e+="[-]?")):s+=l}return r||(e="[-]?"+e),""!=s&&(e=e+"(?:"+RegExp.quote(s)+")?"),e="^"+e+"$",new RegExp(e).test(t)||isNumericExpression(t)}function getCurrencyValue(t){if(!isValidCurrency(t))return NaN;var e=t.replaceAll(Number.groupingSeparator,"").replaceAll(Number.decimalSeparator,".");return getNumericExpression(e)||parseFloat(e.replace(/[^-0123456789.]/,""))}function formatCurrency(t){return formatNumber(t,Number.currencyFormat)}function formatNumber(t,e){e||(e="##0.00");for(var n=Number.decimalSeparator,r=Number.groupingSeparator,a=Number.minusSign,s="0#-,.",i="",o=!1,l=0;l<e.length;l++)if(-1==s.indexOf(e.charAt(l)))i+=e.charAt(l);else{if(0!=l||"-"!=e.charAt(l))break;o=!0}for(var d="",l=e.length-1;l>=0&&-1==s.indexOf(e.charAt(l));l--)d=e.charAt(l)+d;e=e.substring(i.length),e=e.substring(0,e.length-d.length);var h=new Number(t),u=!1;isNaN(h)&&(h=0,u=!0),"%"==d&&(h*=100);var c="";if(e.indexOf(".")>-1){var f=n,p=e.substring(e.lastIndexOf(".")+1);h=new Number(h.toFixed(p.length));var g=h%1,m=new String(g.toFixed(p.length));m=m.substring(m.lastIndexOf(".")+1);for(var l=0;l<p.length;l++)if("#"==p.charAt(l)&&"0"!=m.charAt(l))f+=m.charAt(l);else if("#"==p.charAt(l)&&"0"==m.charAt(l)){var v=m.substring(l);if(!v.match("[1-9]"))break;f+=m.charAt(l)}else"0"==p.charAt(l)&&(f+=m.charAt(l));c+=f}else h=Math.round(h);var y=Math.floor(h);h<0&&(y=Math.ceil(h));var T="";T=-1==e.indexOf(".")?e:e.substring(0,e.indexOf("."));var k="";if(0!=y||"#"!=T.substr(T.length-1)||u){var D=new String(Math.abs(y)),w=9999;-1!=T.lastIndexOf(",")&&(w=T.length-T.lastIndexOf(",")-1);for(var S=0,l=D.length-1;l>-1;l--)k=D.charAt(l)+k,++S==w&&0!=l&&(k=r+k,S=0);if(T.length>k.length){var E=T.indexOf("0");if(-1!=E)for(var b=T.length-E,_=T.length-k.length-1;k.length<b;){var M=T.charAt(_);","==M&&(M=r),k=M+k,_--}}}return k||-1===T.indexOf("0",T.length-1)||(k="0"),c=k+c,h<0&&o&&i.length>0?i=a+i:h<0&&(c=a+c),c.lastIndexOf(n)==c.length-1&&(c=c.substring(0,c.length-1)),c=i+c+d}function saveFormValues(t){var e=obj(t);e.setAttribute("savedAction",e.action),e.setAttribute("savedTarget",e.target);var n=e.elements;for(i=0;i<n.length;i++)null!=n[i].getAttribute("savedValue")&&n[i].setAttribute("savedValue",n[i].value)}function restoreFormValues(t){var e=obj(t);e.action=e.getAttribute("savedAction"),e.target=e.getAttribute("savedTarget");var n=e.elements;for(i=0;i<n.length;i++)null!=n[i].getAttribute("savedValue")&&(n[i].value=n[i].getAttribute("savedValue"))}function changeActionAndSubmit(t,e){var n=$("form:first");n.prop("action",t),n.find("[name=CM]").val(e),n.submit()}function limitSize(t){if(t.getAttribute("maxlength")){var e=parseInt(t.getAttribute("maxlength")),n=t.value;n.length>e?(t.value=n.substr(0,e),$(t).createErrorAlert("Error",i18n.ERR_FIELD_MAX_SIZE_EXCEEDED)):$(t).clearErrorAlert()}return!0}function alertOnUnload(t){if(!muteAlertOnChange){"function"==typeof managePageUnload&&managePageUnload(),t=t||$("body");for(var e=$("[alertonchange=true]",t).find("[oldValue=1]"),n=0;n<e.length;n++){var r=e.eq(n);r.getOldValue();if("true"!=""+r.attr("excludeFromAlert"))if(r.attr("maleficoTiny")){if(tinymce.EditorManager.get(r.prop("id")).isDirty())return i18n.FORM_IS_CHANGED+' "'+r.prop("name")+'"'}else if(r.isValueChanged()){var a=$("label[for='"+r.prop("id")+"']").text();return a=a||r.prop("name"),i18n.FORM_IS_CHANGED+' "'+a+'"'}}}}function canILeave(){var t=window.onbeforeunload();return!(void 0!==t&&!confirm(t+"  \n"+i18n.PROCEED))}function enlargeTextArea(t){var e=$(this),n=!0===t?1:300;e.stopTime("taResizeApply"),e.oneTime(n,"taResizeApply",function(){var t=e.is("[minHeight]")?parseInt(e.attr("minHeight")):30,n=e.is("[maxHeight]")?parseInt(e.attr("maxHeight")):400,r=e.is("[lineHeight]")?parseInt(e.attr("lineHeight")):30;e.css({maxHeight:n,minHeight:t});var a=e.get(0),s=e.outerHeight()-e.height();if(a.scrollHeight>e.outerHeight()&&e.outerHeight()<n){var i=a.scrollHeight-s+r;i=i>n-s?n-s:i,e.height(i)}else if(e.height()>t){for(e.height(e.height()-r);e.outerHeight()-a.scrollHeight>0&&e.height()>t;)e.height(e.height()-r);var o=a.scrollHeight-s+r;e.height(o)}e.stopTime("winResize")})}function pad(t,e,n){return(t+"").length<e?new Array(e-(""+t).length+1).join(n)+t:t}function getMillisInHours(t){if(!t)return"";var e=Math.floor(t/36e5);return(t>=0?"":"-")+pad(e,1,"0")}function getMillisInHoursMinutes(t){if("number"!=typeof t)return"";var e=t>=0?1:-1;t=Math.abs(t);var n=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4);return(e>0?"":"-")+pad(n,1,"0")+":"+pad(r,2,"0")}function getMillisInDaysHoursMinutes(t){if(!t)return"";var e=t>=0?1:-1;t=Math.abs(t);var n=Math.floor(t/millisInWorkingDay),r=Math.floor(t%millisInWorkingDay/36e5),a=Math.floor((t-n*millisInWorkingDay-36e5*r)/6e4);return(e>=0?"":"-")+(n>0?n+"  ":"")+pad(r,1,"0")+":"+pad(a,2,"0")}function millisFromHourMinute(t){var e=0;t.replace(",",".");var n=t.indexOf(":"),r=t.indexOf(".");if(n<0&&r<0&&t.length>5)return parseInt(t,10);if(r>-1){e=36e5*parseFloat(t)}else{var a=0,s=0;-1==n?a=parseInt(t,10):(a=parseInt(t.substring(0,n),10),s=parseInt(t.substring(n+1),10)),e=36e5*a+6e4*s}return"number"!=typeof e&&(e=NaN),e}function millisFromString(t,e){if(!t)return 0;var n=new RegExp("([0-9\\.,]+[Yy])|([0-9\\.,]+[M])|([0-9\\.,]+[Ww])|([0-9\\.,]+[Dd])|([0-9\\.,]+[Hh])|([0-9\\.,]+[m])|([0-9\\.,]+[Ss])|(\\d+:\\d+)|(:\\d+)|(\\d*[\\.,]\\d+)|(\\d+)","g"),r=n.exec(t),a=0;if(!r)return NaN;for(;null!=r;){for(var s=1;s<r.length;s++){var i=r[s];if(i){var o=0;try{o=parseFloat(i.replace(",","."))}catch(t){}1==s?a+=o*(e?millisInWorkingDay*workingDaysPerWeek*52:31536e6):2==s?a+=o*(e?millisInWorkingDay*workingDaysPerWeek*4:2592e6):3==s?a+=o*(e?millisInWorkingDay*workingDaysPerWeek:6048e5):4==s?a+=o*(e?millisInWorkingDay:864e5):5==s?a+=36e5*o:6==s?a+=6e4*o:7==s?a+=1e3*o:8==s?a+=millisFromHourMinute(i):9==s?a+=millisFromHourMinute(i):10==s?a+=millisFromHourMinute(i):11==s&&(a+=36e5*o)}}r=n.exec(t)}return a}function daysFromString(t,e){if(t){var n=new RegExp("([0-9\\.,]+[Yy])|([0-9\\.,]+[Mm])|([0-9\\.,]+[Ww])|([0-9\\.,]+[Dd])|(\\d*[\\.,]\\d+)|(\\d+)","g"),r=n.exec(t),a=0;if(!r)return NaN;for(;null!=r;){for(var s=1;s<r.length;s++){var i=r[s];if(i){var o=0;try{o=parseInt(i),o=parseFloat(i.replace(",","."))}catch(t){}1==s?a+=o*(e?52*workingDaysPerWeek:365):2==s?a+=o*(e?4*workingDaysPerWeek:30):3==s?a+=o*(e?workingDaysPerWeek:7):4==s?a+=o:5==s?a+=o:6==s&&(a+=o)}}r=n.exec(t)}return parseInt(a)}}function centerPopup(t,e,n,r,a,s){var i=(screen.width-n)/2,o=(screen.height-r)/2,l="height="+r+",width="+n+",top="+o+",left="+i+",scrollbars="+a+",resizable="+s+", toolbars=false, status=false, menubar=false",d=window.open(t,e,l);d||alert("A popup blocker was detected: please allow them for this application (check out the upper part of the browser window)."),parseInt(navigator.appVersion)>=4&&d.window.focus()}function openCenteredWindow(t,e,n){var r=n.split(","),a=0,i=800,o=600;if(n&&""!=n){for(;a<r.length;)r[a].indexOf("width")>-1?(s=r[a].substring(r[a].indexOf("=")+1),i=parseInt(s)):r[a].indexOf("height")>-1&&(s=r[a].substring(r[a].indexOf("=")+1),o=parseInt(s)),a+=1;var l=(screen.width-i)/2;n=n+",top="+(screen.height-o)/2+",left="+l}win=window.open(t,e,n),win||alert("A popup blocker was detected: please allow them for this application (check out the upper part of the browser window)."),parseInt(navigator.appVersion)>=4&&win.window.focus()}function showFeedbackMessage(t,e,n,r){r||(r=0);var a,s=$("#__FEEDBACKMESSAGEPLACE");a="object"==typeof t?t:{type:t,message:e,title:n};var i=$(".FFC_"+a.type+":visible ._errorTemplateMessage");i.length>0?i.append("<hr>"+(a.title?"<b>"+a.title+"</b><br>":"")+a.message+"<br>"):(i=$.JST.createFromTemplate(a,"errorTemplate"),s.append(i),s.fadeIn()),r>0&&setTimeout(function(){i.fadeOut()},r),$(".FFC_OK").stopTime("ffchide").oneTime(1500,"ffchide",function(){$(this).fadeOut(400,function(){$(this)})}),$(".FFC_WARNING").stopTime("ffchide").oneTime(75e3,"ffchide",function(){$(this).fadeOut(400,function(){$(this)})}),$(".FFC_ERROR").stopTime("ffchide").oneTime(1e4,"ffchide",function(){$(this).fadeOut(400,function(){$(this)})})}function showFeedbackMessageInDiv(t,e,n){var r=$("#"+n),a={type:t,message:e};r.prepend($.JST.createFromTemplate(a,"errorTemplate")),r.fadeIn(),$("body").oneTime(1200,function(){$(".FFC_OK").fadeOut()})}function hideFeedbackMessages(){$("#__FEEDBACKMESSAGEPLACE").empty()}function submitInBlack(t,e,n,r){n||(n=$(window).width()-100),r||(r=$(window).height()-50),openBlackPopup("",n+"px",r+"px",null,t+"_ifr");var a=$("#"+t),s=a.prop("action"),i=a.prop("target");a.prop("action",e),a.prop("target",t+"_ifr"),$(window).data("openerForm",a),a.submit(),a.prop("action",s),i?a.prop("target",i):a.removeAttr("target")}function createModalPopup(t,e,n,r,a,s){function i(){var t=($(window).height()-h)/2-100;return t<0?10:t}"function"==typeof disableUploadize&&disableUploadize(),s=s||window,t||(t="80%"),e||(e="80%");var o=t,l=e;"string"==typeof t&&t.indexOf("%")>0&&(o=function(){return $(window).width()*parseFloat(t)/100}),"string"==typeof e&&e.indexOf("%")>0&&(l=function(){return $(window).height()*parseFloat(e)/100});var d=o,h=l;"function"==typeof o&&(d=o()),"function"==typeof l&&(h=l()),d=parseFloat(d),h=parseFloat(h),"string"==typeof n&&(r=n);var u=__popups.length+1;__popups.push("__popup__"+u);var c=isIframe(),f=$("<div>").prop("id","__popup__"+u);f.addClass("modalPopup"+(c?" inIframe":"")).hide(),r&&f.addClass(r);var p=$("<div>").addClass("bwinPopupd").css({width:d,minHeight:h,marginTop:i(),maxHeight:$(window).height()-20,overflow:"auto"});$(window).off("resize.popup"+u).on("resize.popup"+u,function(){"function"==typeof o&&(d=o()),"function"==typeof l&&(h=l()),p.css({width:d,minHeight:h});var t=p.outerWidth()>$(window).width()-20?$(window).width()-20:d,e=p.outerHeight()>$(window).height()-20?$(window).height()-20:h;p.css({marginTop:i(),minHeight:e,maxHeight:$(window).height()-20,minWidth:t})}),f.append(p);a||$("#twMainContainer").addClass("blur"),function(t,e,n){c?(p.css({marginTop:-50}),t.show(),p.animate({marginTop:0},e/2,n)):(p.css({opacity:0,top:-50}).show(),t.fadeIn(e,function(){p.animate({top:0,opacity:1},e/3,n)}))}(f,300,function(){}),f.on("click",function(t){$(t.target).closest(".bwinPopupd").length<=0&&f.trigger("close")});var g=$("<span class=\"teamworkIcon close popUpClose\" style='cursor:pointer;position:absolute;'>x</span>");return p.append(g),g.click(function(){f.trigger("close")}),$("body").css({overflowY:"hidden"}),a?a.after(f):$("body").append(f),f.on("close",function(){var t=$(this).data("callBackdata"),e=f;"function"==typeof enableUploadize&&enableUploadize();var r,a=f.find("iframe");if(a.length>0)try{r=a.get(0).contentWindow.alertOnUnload()}catch(t){}else r=alertOnUnload(e);r&&!confirm(r)||f.fadeOut(100,function(){$(window).off("resize.popup"+u),f.remove(),__popups.pop(),0==__popups.length&&$("#twMainContainer").removeClass("blur"),"function"==typeof n&&n(t),$("body").css({overflowY:"auto"})})}),f.on("destroy",function(){f.remove(),$("body").css({overflowY:"auto"})}),$("body").oneTime(1e3,"br",function(){$(this).resize()}),f.data("__opener",s),p}function changeModalSize(t,e){var n={};t&&(n.width=t),e&&(n.minHeight=e);var r=isIframe(),a=r?window.parent.$(".bwinPopupd"):$(".bwinPopupd");a.length&&a.delay(300).animate(n,200)}function openBlackPopup(t,e,n,r,a,s){a||(a="bwinPopupIframe");var i=s?s+" iframe":"iframe",o=top.createModalPopup(e,n,r,i,null,window),l=isIframe();o.append("<div class='bwinPopupIframe_wrapper'><iframe id='"+a+"' name='"+a+"' frameborder='0'></iframe></div>"),o.find("iframe:first").prop("src",t).css({width:"100%",height:"100%",backgroundColor:l?"#F9F9F9":"#FFFFFF"})}function getBlackPopup(){var t=$([]);if(__popups.length>0){var e=__popups[__popups.length-1];t=$("#"+e)}return 0==t.length&&window!=top&&(t=window.parent.getBlackPopup()),t}function getBlackPopupOpener(){return getBlackPopup().data("__opener")}function closeBlackPopup(t){var e=getBlackPopup();t&&e.data("callBackdata",t),e.trigger("close")}function openPopUp(t,e,n){createModalPopup(e,n).append(t.clone().show())}function isIframe(){var t=!1;try{self.location.href!=top.location.href&&(t=!0)}catch(e){t=!0}return t}function openBulkAction(t){createModalPopup(500,300).append($("#"+t).clone().show())}function refreshBulk(t){t.is(":checked")?t.closest("tr").addClass("selected"):t.closest("tr").removeClass("selected");var e=t.closest(".dataTable");if(e.find(".selected :checked").length>0){$("#bulkOp #bulkRowSel").html(e.find("tbody > tr.selected").length+"/"+e.children("tbody").children("tr").length);var n=$("#bulkOp").clone().addClass("bulkOpClone");n.fadeIn(200,function(){$("#bulkPlace").html(n),$.tableHF.refreshTfoot()})}else $(".bulkOpClone").fadeOut(200,function(){$.tableHF.refreshTfoot()})}function selUnselAll(t){var e=t.closest(".dataTable").find("[type='checkbox']");t.is(":checked")?(e.prop("checked",!0),e.closest("tr").addClass("selected")):(e.prop("checked",!1),e.closest("tr").removeClass("selected")),refreshBulk(t)}function nearBestPosition(t,e,n){var r=t,a=e;if("object"!=typeof t&&(r=$("#"+t)),"object"!=typeof e&&(a=$("#"+e)),r){a.css("visibility","hidden");var s=!1;a.parents().each(function(){"static"!=$(this).css("position")&&(s=!0)});var i=s?r.position().left:r.offset().left,o=s?r.position().top:r.offset().top,l=r.outerHeight(),d=parseFloat(l);if(n){i+=(parseFloat(r.outerWidth())-parseFloat(a.outerWidth()))/2}o+=parseFloat(d);var h=i,u=o;if(i&&o&&(a.css("left",h),a.css("top",u)),a.offset().left>=$(window).width()+$(window).scrollLeft()-a.outerWidth()&&(h=$(window).width()+$(window).scrollLeft()-a.outerWidth()-10,a.css({left:h,marginTop:0})),a.offset().left<0&&(h=10,a.css("left",h)),a.offset().top+a.outerHeight()>=$(window).height()+$(window).scrollTop()-45&&a.outerHeight()<$(window).height()){var c=-(a.outerHeight()+r.outerHeight());a.css("margin-top",c)}a.offset().top<0&&(u=0,a.css("top",u)),a.css("visibility","visible")}}function setSelection(t,e,n){t.setSelectionRange(e,n)}function dateToRelative(t){var e=(new Date).getTime()-t,n=6048e5,r=26298e5,a=315576e5;return e<2*-a?"in ## years".replace("##",(-e/a).toFixed(0)):e<9*-r?"in ## months".replace("##",(-e/r).toFixed(0)):e<5*-n?"in ## weeks".replace("##",(-e/n).toFixed(0)):e<-1728e5?"in ## days".replace("##",(-e/864e5).toFixed(0)):e<-36e5?"in ## hours".replace("##",(-e/36e5).toFixed(0)):e<-21e5?"in about one hour":e<-15e5?"in about half hour":e<-6e5?"in some minutes":e<-12e4?"in few minutes":e<=6e4?"just now":e<=3e5?"few minutes ago":e<=9e5?"some minutes ago":e<=21e5?"about half hour ago":e<=45e5?"about an hour ago":e<=18e6?"few hours ago":e<=864e5?"## hours ago".replace("##",(e/36e5).toFixed(0)):e<=6048e5?"## days ago".replace("##",(e/864e5).toFixed(0)):e<=5*n?"## weeks ago".replace("##",(e/n).toFixed(0)):e<=12*r?"## months ago".replace("##",(e/r).toFixed(0)):"## years ago".replace("##",(e/a).toFixed(0))}function isHoliday(t){var e=function(t){return t="0"+t,t.substr(t.length-2)},n="##",r="#"+t.getFullYear()+"_"+e(t.getMonth()+1)+"_"+e(t.getDate())+"#",a="#"+e(t.getMonth()+1)+"_"+e(t.getDate())+"#",s=t.getDay();return 5==s&&!1||6==s&&!0||0==s&&!0||n.indexOf(r)>-1||n.indexOf(a)>-1}function computeStart(t){return computeStartDate(t).getTime()}function computeStartDate(t){var e=new Date(t+432e5);for(e.setHours(0,0,0,0);isHoliday(e);)e.setDate(e.getDate()+1);return e.setHours(0,0,0,0),e}function computeEnd(t){return computeEndDate(t).getTime()}function computeEndDate(t){var e=new Date(t-432e5);for(e.setHours(23,59,59,999);isHoliday(e);)e.setDate(e.getDate()+1);return e.setHours(23,59,59,999),e}function computeEndByDuration(t,e){for(var n=new Date(t),r=e-1;r>0;)n.setDate(n.getDate()+1),isHoliday(n)||r--;return n.setHours(23,59,59,999),n.getTime()}function incrementDateByWorkingDays(t,e){var n=new Date(t);return n.incrementDateByWorkingDays(e),n.getTime()}function recomputeDuration(t,e){return new Date(t).distanceInWorkingDays(new Date(e))+1}function resynchDates(t,e,n,r,a,s){function i(t){var n=daysFromString(r.val(),!0);(!n||n<1)&&(n=1);var s=computeStart(Date.parseString(e.val()).getTime()),i=a.val();i.length>0&&(i=Date.parseString(i),i.setHours(23,59,59,999),i=computeEnd(i.getTime()));var o=new Date;if("CHANGE_END"==t){o.setTime(s);var l=n-1;o.incrementDateByWorkingDays(l),o.setHours(23,59,59,999),i=computeEnd(o.getTime())}else if("CHANGE_START"==t){o.setTime(i);var l=n-1;o.incrementDateByWorkingDays(-l),o.setHours(0,0,0,0),s=computeStart(o.getTime())}else"CHANGE_DURATION"==t&&(n=new Date(s).distanceInWorkingDays(new Date(i))+1);return e.val(new Date(s).format()),a.val(new Date(i).format()),r.val(n),{start:s,end:i,duration:n}}var o=t.prop("name"),l=r.val().length>0,d=e.val().length>0,h=a.val().length>0,u=d&&(n.prop("checked")||e.is("[readOnly]")),c=h&&(s.prop("checked")||a.is("[readOnly]"));if(l&&(NaN==parseInt(r.val())||parseInt(r.val())<1)&&r.val(1),o.indexOf("Milestone")>0)return void(u&&c?r.prop("readOnly",!0):r.prop("readOnly",!1));if(!((l?1:0)+(d?1:0)+(h?1:0)<2)){var f;return"start"==o&&d?c&&l?f=i("CHANGE_DURATION"):l&&(f=i("CHANGE_END")):"duration"!=o||!l||c&&u?"end"==o&&h&&(f=i("CHANGE_DURATION")):c&&!u?f=i("CHANGE_START"):c||(f=i("CHANGE_END")),f}}function goToPage(t){canILeave()&&(window.location.href=t)}function TaskFactory(){this.build=function(t,e,n,r,a,s,i){var o=computeStart(a);return new Task(t,e,n,r,o,computeEndByDuration(o,s),s,i)}}function Task(t,e,n,r,a,s,i,o){this.id=t,this.name=e,this.progress=0,this.progressByWorklog=!1,this.relevance=0,this.type="",this.typeId="",this.description="",this.code=n,this.level=r,this.status="STATUS_UNDEFINED",this.depends="",this.canWrite=!0,this.start=a,this.duration=i,this.end=s,this.startIsMilestone=!1,this.endIsMilestone=!1,this.collapsed=o,this.rowElement,this.ganttElement,this.master,this.assigs=[]}function updateTree(t){var e=t.getParent();if(!e)return!0;var n=e.start,r=e.end;if(e.start>t.start){if(e.startIsMilestone)return t.master.setErrorOnTransaction('"'+e.name+'"\n'+GanttMaster.messages.START_IS_MILESTONE,t),!1;if(e.depends)return t.master.setErrorOnTransaction('"'+e.name+'"\n'+GanttMaster.messages.TASK_HAS_CONSTRAINTS,t),!1;n=t.start}if(e.end<t.end){if(e.endIsMilestone)return t.master.setErrorOnTransaction('"'+e.name+'"\n'+GanttMaster.messages.END_IS_MILESTONE,t),!1;r=t.end}return n==e.start&&r==e.end||(e.canWrite?e.hasExternalDep?(t.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS+'\n"'+e.name+'"',t),!1):e.setPeriod(n,r):(t.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+e.name,t),!1))}function Link(t,e,n){this.from=t,this.to=e,this.lag=n}function Assignment(t,e,n,r){this.id=t,this.resourceId=e,this.roleId=n,this.effort=r}function Resource(t,e){this.id=t,this.name=e}function Role(t,e){this.id=t,this.name=e}function Ganttalendar(t,e,n,r,a){this.master=r,this.element,this.svg,this.tasksGroup,this.linksGroup,this.zoom=t,this.minGanttSize=a,this.includeToday=!0,this.showCriticalPath=!1,this.zoomLevels=["d","w","w2","w3","m","m2","q","q2","s","y"],this.element=this.create(t,e,n),this.linkOnProgress=!1,this.rowHeight=30,this.taskHeight=20,this.taskVertOffset=(this.rowHeight-this.taskHeight)/2}function GridEditor(t){this.master=t;var e=$.JST.createFromTemplate({},"TASKSEDITHEAD");t.permissions.canSeeDep||e.find(".requireCanSeeDep").hide(),this.gridified=$.gridify(e),this.element=this.gridified.find(".gdfTable").eq(1)}function GanttMaster(){this.tasks=[],this.deletedTaskIds=[],this.links=[],this.editor,this.gantt,this.splitter,this.isMultiRoot=!1,this.element,this.resources,this.roles,this.minEditableDate=0,this.maxEditableDate=1/0,this.set100OnClose=!1,this.fillWithEmptyLines=!0,this.minRowsInEditor=30,this.permissions={canWriteOnParent:!0,canWrite:!0,canAdd:!0,canInOutdent:!0,canMoveUpDown:!0,canSeePopEdit:!0,canSeeFullEdit:!0,canSeeDep:!0,canSeeCriticalPath:!0,canAddIssue:!1,cannotCloseTaskIfIssueOpen:!1},this.firstDayOfWeek=Date.firstDayOfWeek,this.serverClientTimeOffset=0,this.currentTask,this.resourceUrl="res/",this.__currentTransaction,this.__undoStack=[],this.__redoStack=[],this.__inUndoRedo=!1}!function(t){t.extend(t.fn,{livequery:function(e,n,r){var a,s=this;return t.isFunction(e)&&(r=n,n=e,e=void 0),t.each(t.livequery.queries,function(t,i){if(!(s.selector!=i.selector||s.context!=i.context||e!=i.type||n&&n.$lqguid!=i.fn.$lqguid||r&&r.$lqguid!=i.fn2.$lqguid))return(a=i)&&!1}),a=a||new t.livequery(this.selector,this.context,e,n,r),a.stopped=!1,a.run(),this},expire:function(e,n,r){var a=this;return t.isFunction(e)&&(r=n,n=e,e=void 0),t.each(t.livequery.queries,function(s,i){a.selector!=i.selector||a.context!=i.context||e&&e!=i.type||n&&n.$lqguid!=i.fn.$lqguid||r&&r.$lqguid!=i.fn2.$lqguid||this.stopped||t.livequery.stop(i.id)}),this}}),t.livequery=function(e,n,r,a,s){return this.selector=e,this.context=n,this.type=r,this.fn=a,this.fn2=s,this.elements=[],this.stopped=!1,this.id=t.livequery.queries.push(this)-1,a.$lqguid=a.$lqguid||t.livequery.guid++,s&&(s.$lqguid=s.$lqguid||t.livequery.guid++),this},t.livequery.prototype={stop:function(){var t=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(e,n){t.fn2.apply(n)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var e=this,n=this.elements,r=t(this.selector,this.context),a=r.not(n);this.elements=r,this.type?(a.bind(this.type,this.fn),n.length>0&&t.each(n,function(n,a){t.inArray(a,r)<0&&t.event.remove(a,e.type,e.fn)})):(a.each(function(){e.fn.apply(this)}),this.fn2&&n.length>0&&t.each(n,function(n,a){t.inArray(a,r)<0&&e.fn2.apply(a)}))}}},t.extend(t.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(t.livequery.running&&t.livequery.queue.length)for(var e=t.livequery.queue.length;e--;)t.livequery.queries[t.livequery.queue.shift()].run()},pause:function(){t.livequery.running=!1},play:function(){t.livequery.running=!0,t.livequery.run()},registerPlugin:function(){t.each(arguments,function(e,n){if(t.fn[n]){var r=t.fn[n];t.fn[n]=function(){var e=r.apply(this,arguments);return t.livequery.run(),e}}})},run:function(e){void 0!=e?t.inArray(e,t.livequery.queue)<0&&t.livequery.queue.push(e):t.each(t.livequery.queries,function(e){t.inArray(e,t.livequery.queue)<0&&t.livequery.queue.push(e)}),t.livequery.timeout&&clearTimeout(t.livequery.timeout),t.livequery.timeout=setTimeout(t.livequery.checkQueue,20)},stop:function(e){void 0!=e?t.livequery.queries[e].stop():t.each(t.livequery.queries,function(e){t.livequery.queries[e].stop()})}}),t.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),t(function(){t.livequery.play()})}(jQuery),jQuery.fn.extend({everyTime:function(t,e,n,r,a){return this.each(function(){jQuery.timer.add(this,t,e,n,r,a)})},oneTime:function(t,e,n){return this.each(function(){jQuery.timer.add(this,t,e,n,1)})},stopTime:function(t,e){return this.each(function(){jQuery.timer.remove(this,t,e)})}}),jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(t){if(void 0==t||null==t)return null;var e=this.regex.exec(jQuery.trim(t.toString()));if(e[2]){return parseInt(e[1],10)*(this.powers[e[2]]||1)}return t},add:function(t,e,n,r,a,s){var i=0;if(jQuery.isFunction(n)&&(a||(a=r),r=n,n=e),!("number"!=typeof(e=jQuery.timer.timeParse(e))||isNaN(e)||e<=0)){a&&a.constructor!=Number&&(s=!!a,a=0),a=a||0,s=s||!1,t.$timers||(t.$timers={}),t.$timers[n]||(t.$timers[n]={}),r.$timerID=r.$timerID||this.guid++;var o=function(){s&&this.inProgress||(this.inProgress=!0,(++i>a&&0!==a||!1===r.call(t,i))&&jQuery.timer.remove(t,n,r),this.inProgress=!1)};o.$timerID=r.$timerID,t.$timers[n][r.$timerID]||(t.$timers[n][r.$timerID]=window.setInterval(o,e)),this.global[n]||(this.global[n]=[]),this.global[n].push(t)}},remove:function(t,e,n){var r,a=t.$timers;if(a){if(e){if(a[e]){if(n)n.$timerID&&(window.clearInterval(a[e][n.$timerID]),delete a[e][n.$timerID]);else for(var n in a[e])window.clearInterval(a[e][n]),delete a[e][n];for(r in a[e])break;r||(r=null,delete a[e])}}else for(e in a)this.remove(t,e,n);for(r in a)break;r||(t.$timers=null)}}}}),jQuery(window).one("unload",function(){var t=jQuery.timer.global;for(var e in t)for(var n=t[e],r=n.length;--r;)jQuery.timer.remove(n[r],e)});var isExplorer=navigator.userAgent.toUpperCase().indexOf("MSIE")>=0||!!navigator.userAgent.match(/Trident.*rv\:11\./),isMozilla=navigator.userAgent.toUpperCase().indexOf("FIREFOX")>=0,isSafari=-1!=navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("chrome")<0,version=navigator.appVersion.substring(0,1),inProduction=!1;inProduction&&(window.console=void 0),window.console||(window.console=new function(){this.log=function(t){},this.debug=function(t){},this.error=function(t){}}),window.console.debug&&window.console.error&&window.console.log||(window.console=new function(){this.log=function(t){},this.debug=function(t){},this.error=function(t){}}),String.prototype.trim=function(){return this.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1")},String.prototype.startsWith=function(t,e){return e?t.toLowerCase()==this.substring(0,t.length).toLowerCase():t==this.substring(0,t.length)},String.prototype.endsWith=function(t,e){return e?t.toLowerCase()==this.substring(this.length-t.length).toLowerCase():t==this.substring(this.length-t.length)},String.prototype.asId=function(){return this.replace(/[^a-zA-Z0-9_]+/g,"")},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(RegExp.quote(t),"g"),e)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){if(null==this)throw new TypeError;var n=Object(this),r=n.length>>>0;if(0===r)return-1;var a=0;if(arguments.length>0&&(a=Number(arguments[1]),a!=a?a=0:0!=a&&a!=1/0&&a!=-1/0&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=r)return-1;for(var s=a>=0?a:Math.max(r-Math.abs(a),0);s<r;s++)if(s in n&&n[s]===t)return s;return-1}),Object.size=function(t){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n},RegExp.quote=function(t){return t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1")},jQuery.fn.activateLinks=function(t){var e=/(['"]\s*)?(http[s]?:[\d]*\/\/[^"<>\s]*)/g,n=/(['"\/]\s*)?(www\.[^"<>\s]+)/g,r=/(['"]\s*)?(http[s]?:[\d]*\/\/[^"<>\s]*\.(?:gif|jpg|png|jpeg|bmp))/g;return this.each(function(){var a=$(this),s=a.html();t&&(s=s.replace(r,function(t,e){return e?t:"<div class='imgWrap'  onclick=\"window.open('"+t+"','_blank');event.stopPropagation();\"><img src='"+t+"' title='"+t+"'></div>"})),s=s.replace(e,function(t,e){return e?t:"<a href='#' onclick=\"window.open('"+t+"','_blank');event.stopPropagation();\">"+t+"</a>"}),s=s.replace(n,function(t,e){return e?t:"<a href='#' onclick=\"window.open('http://"+t+"','_blank');event.stopPropagation();\">"+t+"</a>"}),a.empty().append(s),t&&a.find("div.imgWrap").each(function(){var t=$(this);t.click(function(e){if(e.ctrlKey||e.metaKey)window.open(t.find("img").prop("src"),"_blank");else{var n=t.find("img").clone();n.mouseout(function(){$(this).remove()}),n.addClass("imageClone").css({position:"absolute",display:"none",top:t.position().top,left:t.position().left,"z-index":1e6}),t.after(n),n.fadeIn()}})})}),this},jQuery.fn.emoticonize=function(){function t(t){var e=/(:\))|(:-\))|(:-])|(:-\()|(:\()|(:-\/)|(:-\\)|(:-\|)|(;-\))|(:-D)|(:-P)|(:-p)|(:-0)|(:-o)|(:-O)|(:'-\()|(\(@\))/g;return t.replace(e,function(t){var e={":)":"smile",":-)":"smile",":-]":"polite_smile",":-(":"frown",":(":"frown",":-/":"skepticism",":-\\":"skepticism",":-|":"sarcasm",";-)":"wink",":-D":"grin",":-P":"tongue",":-p":"tongue",":-o":"surprise",":-O":"surprise",":-0":"surprise",":'-(":"tear","(@)":"angry"}[t];return e?e="<img src='"+contextPath+"/img/smiley/"+e+".png' align='absmiddle'>":t})}function e(t){var e=/\*\*[^*]*\*\*/gi;return t.replace(e,function(t){var e=t.substr(2);return"<b>"+e.substr(0,e.length-2)+"</b>"})}return this.each(function(){var n=$(this),r=t(n.html());r=e(r),n.html(r)}),this},$.fn.unselectable=function(){return this.each(function(){$(this).addClass("unselectable").attr("unselectable","on")}),$(this)},$.fn.clearUnselectable=function(){return this.each(function(){$(this).removeClass("unselectable").removeAttr("unselectable")}),$(this)};var __initedComponents=new Object;Storage.prototype.setObject=function(t,e){this.setItem(t,JSON.stringify(e))},Storage.prototype.getObject=function(t){return this.getItem(t)&&JSON.parse(this.getItem(t))},$.fn.isEmptyElement=function(){return!$.trim($(this).html())},"funcion"!=typeof $.fn.size&&($.fn.size=function(){return this.length});var muteAlertOnChange=!1;jQuery.fn.isFullfilled=function(){var t=!0,e="";if(this.each(function(){var n=$(this);if(n.removeClass("formElementsError"),n.is("[required]")&&0==n.val().trim().length||"true"==n.attr("invalid")){if("hidden"==n.attr("type"))n=n.prevAll("#"+n.prop("id")+"_txt:first");else if(n.is("[withTinyMCE]")){if(""!=tinymce.activeEditor.getContent())return!0;n=$("#"+n.attr("name")+"_tbl")}n.addClass("formElementsError"),t=!1,""==e&&(e=n)}}),!t){var n=e.closest(".tabBox");n.length>0&&clickTab(n.attr("tabId")),e.effect("highlight",{color:"red"},1500)}return t},jQuery.fn.validateField=function(){var t=!0;return this.each(function(){var e=$(this);e.clearErrorAlert();var n=e.val();if(n){var r,a=!0,s=(e.attr("entryType")+"").toUpperCase();if("INTEGER"==s?a=isValidInteger(n):"DOUBLE"==s?a=isValidDouble(n):"PERCENTILE"==s?a=isValidDouble(n):"URL"==s?a=isValidURL(n):"EMAIL"==s?a=isValidEmail(n):"DURATIONMILLIS"==s?a=isValidDurationMillis(n):"DURATIONDAYS"==s?a=isValidDurationDays(n):"DATE"==s?(a=Date.isValid(n,e.attr("format"),!0))||(r=e.attr("format")):"TIME"==s?a=isValidTime(n):"CURRENCY"==s&&(a=isValidCurrency(n)),a||(e.createErrorAlert(i18n.ERROR_ON_FIELD,i18n.INVALID_DATA+(r?" "+r:"")),t=!1),a&&(e.attr("minValue")||e.attr("maxValue"))){var i=n,o=e.attr("minValue"),l=e.attr("maxValue");"INTEGER"==s?(i=parseInt(n),o=parseInt(o),l=parseInt(l)):"DOUBLE"==s||"PERCENTILE"==s?(i=parseDouble(n),o=parseDouble(o),l=parseDouble(l)):"URL"==s?i=n:"EMAIL"==s?i=n:"DURATIONMILLIS"==s?(i=millisFromString(n),o=millisFromString(o),l=millisFromString(l)):"DURATIONDAYS"==s?(i=daysFromString(n),o=daysFromString(o),l=daysFromString(l)):"DATE"==s?(i=Date.parseString(n,e.attr("format"),!0).getTime(),o=Date.parseString(o,e.attr("format"),!0).getTime(),l=Date.parseString(l,e.attr("format"),!0).getTime()):"TIME"==s?(i=millisFromHourMinute(n),o=millisFromHourMinute(o),l=millisFromHourMinute(l)):"CURRENCY"==s&&(i=getCurrencyValue(n),o=getCurrencyValue(o),l=getCurrencyValue(l)),e.attr("minValue")&&i<o&&(e.createErrorAlert(i18n.ERROR_ON_FIELD,i18n.OUT_OF_BOUDARIES+" ("+e.attr("minValue")+" : "+(e.attr("maxValue")?e.attr("maxValue"):"--")+")"),a=!1,t=!1,$("body").trigger("error")),a&&e.attr("maxValue")&&i>l&&(e.createErrorAlert(i18n.ERROR_ON_FIELD,i18n.OUT_OF_BOUDARIES+" ("+(e.attr("minValue")?e.attr("minValue"):"--")+" : "+e.attr("maxValue")+")"),a=!1,t=!1)}}}),t},jQuery.fn.clearErrorAlert=function(){return this.each(function(){var t=$(this);t.removeAttr("invalid").removeClass("formElementsError"),$("#"+t.prop("id")+"error").remove()}),this},jQuery.fn.createErrorAlert=function(t,e){return this.each(function(){var n=$(this);if(n.attr("invalid","true").addClass("formElementsError"),$("#"+n.prop("id")+"error").length<=0){var r=(t||"")+": "+(e||""),a="<span class='formElementExclamation' id=\""+n.prop("id")+"error\" error='1'";a+=" onclick=\"alert($(this).attr('title'))\" border='0' align='absmiddle'>&nbsp;",a+="</span>\n",a=$(a),a.prop("title",r),n.after(a)}}),this},jQuery.fn.updateOldValue=function(){return this.each(function(){var t=$(this),e=(t.is(":checkbox,:radio")?t.prop("checked"):t.val())+"";t.data("_oldvalue",e)}),this},jQuery.fn.isValueChanged=function(){var t=!1;return this.each(function(){var e=$(this);if((e.is(":checkbox,:radio")?e.prop("checked"):e.val())+""!=e.data("_oldvalue")+"")return t=!0,!1}),t},jQuery.fn.getOldValue=function(){return $(this).data("_oldvalue")},jQuery.fn.fillJsonWithInputValues=function(t){var e=this.find(":input");return $.each(e.serializeArray(),function(){this.name&&(t[this.name]=this.value)}),e.filter(":checkbox[name]").each(function(){var e=$(this);t[e.attr("name")]=e.is(":checked")?"yes":"no"}),this},Date.$VERSION=1.02,Date.LZ=function(t){return(t<0||t>9?"":"0")+t},Date.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),Date.monthAbbreviations=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),Date.dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),Date.dayAbbreviations=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),Date.preferAmericanFormat=!0,Date.firstDayOfWeek=0,Date.defaultFormat="dd/MM/yyyy",Date.prototype.getFullYear||(Date.prototype.getFullYear=function(){var t=this.getYear();return t<1900?t+1900:t}),Date.parseString=function(t,e,n){if(void 0===e||null==e||""==e){for(var r=new Array(Date.defaultFormat,"y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","MMM-d","d-MMM"),a=new Array("M/d/y","M-d-y","M.d.y","M/d","M-d"),s=new Array("d/M/y","d-M-y","d.M.y","d/M","d-M"),i=new Array(r,Date.preferAmericanFormat?a:s,Date.preferAmericanFormat?s:a),o=0;o<i.length;o++)for(var l=i[o],d=0;d<l.length;d++){var h=Date.parseString(t,l[d]);if(null!=h)return h}return null}this.isInteger=function(t){for(var e=0;e<t.length;e++)if(-1=="1234567890".indexOf(t.charAt(e)))return!1;return!0},this.getInt=function(t,e,n,r){for(var a=r;a>=n;a--){var s=t.substring(e,e+a);if(s.length<n)return null;if(this.isInteger(s))return s}return null},this.decodeShortcut=function(t){t=t||"";var e=t.trim().toUpperCase(),n=new Date;if(n.clearTime(),["NOW","N"].indexOf(e)>=0)n=new Date;else if(["TODAY","T"].indexOf(e)>=0);else if(["YESTERDAY","Y"].indexOf(e)>=0)n.setDate(n.getDate()-1);else if(["TOMORROW","TO"].indexOf(e)>=0)n.setDate(n.getDate()+1);else if(["W","TW","WEEK","THISWEEK","WEEKSTART","THISWEEKSTART"].indexOf(e)>=0)n.setFirstDayOfThisWeek();else if(["LW","LASTWEEK","LASTWEEKSTART"].indexOf(e)>=0)n.setFirstDayOfThisWeek(),n.setDate(n.getDate()-7);else if(["NW","NEXTWEEK","NEXTWEEKSTART"].indexOf(e)>=0)n.setFirstDayOfThisWeek(),n.setDate(n.getDate()+7);else if(["M","TM","MONTH","THISMONTH","MONTHSTART","THISMONTHSTART"].indexOf(e)>=0)n.setDate(1);else if(["LM","LASTMONTH","LASTMONTHSTART"].indexOf(e)>=0)n.setDate(1),n.setMonth(n.getMonth()-1);else if(["NM","NEXTMONTH","NEXTMONTHSTART"].indexOf(e)>=0)n.setDate(1),n.setMonth(n.getMonth()+1);else if(["Q","TQ","QUARTER","THISQUARTER","QUARTERSTART","THISQUARTERSTART"].indexOf(e)>=0)n.setDate(1),n.setMonth(3*Math.floor(n.getMonth()/3));else if(["LQ","LASTQUARTER","LASTQUARTERSTART"].indexOf(e)>=0)n.setDate(1),n.setMonth(3*Math.floor(n.getMonth()/3)-3);else if(["NQ","NEXTQUARTER","NEXTQUARTERSTART"].indexOf(e)>=0)n.setDate(1),n.setMonth(3*Math.floor(n.getMonth()/3)+3);else if(/^-?[0-9]+[DWMY]$/.test(e)){var r=e.substr(e.length-1),a=parseInt(e.substr(0,e.length-1));"W"==r?n.setDate(n.getDate()+7*a):"M"==r?n.setMonth(n.getMonth()+a):"Y"==r&&n.setYear(n.getYear()+a)}else n=void 0;return n};var u=this.decodeShortcut(t);if(u)return u;this._getDate=function(t,e){t+="",e+="";for(var n,r,a=0,s=0,i="",o="",l=(new Date).getFullYear(),d=1,h=1,u=0,c=0,f=0,p="";s<e.length;){for(i=e.charAt(s),o="";e.charAt(s)==i&&s<e.length;)o+=e.charAt(s++);if("yyyy"==o||"yy"==o||"y"==o){if("yyyy"==o&&(n=4,r=4),"yy"==o&&(n=2,r=2),"y"==o&&(n=2,r=4),null==(l=this.getInt(t,a,n,r)))return null;a+=l.length,2==l.length&&(l=l>70?l-0+1900:l-0+2e3)}else if("MMM"==o||"MMMM"==o){d=0;for(var g="MMMM"==o?Date.monthNames.concat(Date.monthAbbreviations):Date.monthAbbreviations,m=0;m<g.length;m++){var v=g[m];if(t.substring(a,a+v.length).toLowerCase()==v.toLowerCase()){d=m%12+1,a+=v.length;break}}if(d<1||d>12)return null}else if("E"==o||"EE"==o||"EEE"==o||"EEEE"==o)for(var g="EEEE"==o?Date.dayNames:Date.dayAbbreviations,m=0;m<g.length;m++){var y=g[m];if(t.substring(a,a+y.length).toLowerCase()==y.toLowerCase()){a+=y.length;break}}else if("MM"==o||"M"==o){if(null==(d=this.getInt(t,a,o.length,2))||d<1||d>12)return null;a+=d.length}else if("dd"==o||"d"==o){if(null==(h=this.getInt(t,a,o.length,2))||h<1||h>31)return null;a+=h.length}else if("hh"==o||"h"==o){if(null==(u=this.getInt(t,a,o.length,2))||u<1||u>12)return null;a+=u.length}else if("HH"==o||"H"==o){if(null==(u=this.getInt(t,a,o.length,2))||u<0||u>23)return null;a+=u.length}else if("KK"==o||"K"==o){if(null==(u=this.getInt(t,a,o.length,2))||u<0||u>11)return null;a+=u.length,u++}else if("kk"==o||"k"==o){if(null==(u=this.getInt(t,a,o.length,2))||u<1||u>24)return null;a+=u.length,u--}else if("mm"==o||"m"==o){if(null==(c=this.getInt(t,a,o.length,2))||c<0||c>59)return null;a+=c.length}else if("ss"==o||"s"==o){if(null==(f=this.getInt(t,a,o.length,2))||f<0||f>59)return null;a+=f.length}else if("a"==o){if("am"==t.substring(a,a+2).toLowerCase())p="AM";else{if("pm"!=t.substring(a,a+2).toLowerCase())return null;p="PM"}a+=2}else{if(t.substring(a,a+o.length)!=o)return null;a+=o.length}}if(a!=t.length)return null;if(2==d)if(l%4==0&&l%100!=0||l%400==0){if(h>29)return null}else if(h>28)return null;return(4==d||6==d||9==d||11==d)&&h>30?null:(u<12&&"PM"==p?u=u-0+12:u>11&&"AM"==p&&(u-=12),new Date(l,d-1,h,u,c,f))};var c=this._getDate(t,e);if(!c&&n){var f=e.replace("MMMM","M").replace("MMM","M").replace("MM","M").replace("yyyy","y").replace("yyy","y").replace("yy","y").replace("dd","d");return this._getDate(t,f)}return c},Date.isValid=function(t,e,n){return null!=Date.parseString(t,e,n)},Date.prototype.isBefore=function(t){return null!=t&&this.getTime()<t.getTime()},Date.prototype.isAfter=function(t){return null!=t&&this.getTime()>t.getTime()},Date.prototype.equals=function(t){return null!=t&&this.getTime()==t.getTime()},Date.prototype.equalsIgnoreTime=function(t){if(null==t)return!1;var e=new Date(this.getTime()).clearTime(),n=new Date(t.getTime()).clearTime();return e.getTime()==n.getTime()},Date.prototype.getWeekNumber=function(){var t=new Date(+this);return t.setHours(0,0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7)),Math.ceil(((t-new Date(t.getFullYear(),0,1))/864e5+1)/7)},Date.prototype.format=function(t){t||(t=Date.defaultFormat),t+="";var e="",n=0,r="",a="",s=this.getFullYear()+"",i=this.getMonth()+1,o=this.getDate(),l=this.getDay(),d=this.getHours(),h=this.getMinutes(),u=this.getSeconds(),c=this.getWeekNumber(),f=new Object;for(s.length<4&&(s=""+(+s+1900)),f.y=""+s,f.yyyy=s,f.yy=s.substring(2,4),f.M=i,f.MM=Date.LZ(i),f.MMM=Date.monthAbbreviations[i-1],f.MMMM=Date.monthNames[i-1],f.d=o,f.dd=Date.LZ(o),f.E=Date.dayAbbreviations[l],f.EE=Date.dayAbbreviations[l],f.EEE=Date.dayAbbreviations[l],f.EEEE=Date.dayNames[l],f.H=d,f.HH=Date.LZ(d),f.w=c,f.ww=Date.LZ(c),f.h=0==d?12:d>12?d-12:d,f.hh=Date.LZ(f.h),f.K=f.h-1,f.k=f.H+1,f.KK=Date.LZ(f.K),f.kk=Date.LZ(f.k),f.a=d>11?"PM":"AM",f.m=h,f.mm=Date.LZ(h),f.s=u,f.ss=Date.LZ(u);n<t.length;){for(r=t.charAt(n),a="";t.charAt(n)==r&&n<t.length;)a+=t.charAt(n++);void 0!==f[a]?e+=f[a]:e+=a}return e},Date.prototype.getDayName=function(){return Date.dayNames[this.getDay()]},Date.prototype.getDayAbbreviation=function(){return Date.dayAbbreviations[this.getDay()]},Date.prototype.getMonthName=function(){return Date.monthNames[this.getMonth()]},Date.prototype.getMonthAbbreviation=function(){return Date.monthAbbreviations[this.getMonth()]},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.add=function(t,e){return void 0===t||null==t||void 0===e||null==e?this:(e=+e,"y"==t?this.setFullYear(this.getFullYear()+e):"M"==t?this.setMonth(this.getMonth()+e):"d"==t?this.setDate(this.getDate()+e):"w"==t?this.setDate(this.getDate()+7*e):"h"==t?this.setHours(this.getHours()+e):"m"==t?this.setMinutes(this.getMinutes()+e):"s"==t&&this.setSeconds(this.getSeconds()+e),this)},Date.prototype.toInt=function(){return 1e4*this.getFullYear()+100*(this.getMonth()+1)+this.getDate()},Date.fromInt=function(t){var e=parseInt(t/1e4),n=parseInt((t-1e4*e)/100),r=parseInt(t-1e4*e-100*n);return new Date(e,n-1,r,12,0,0)},Date.prototype.isHoliday=function(){return isHoliday(this)},Date.prototype.isToday=function(){return this.toInt()==(new Date).toInt()},Date.prototype.incrementDateByWorkingDays=function(t){for(var e=Math.abs(t);e>0;)this.setDate(this.getDate()+(t>0?1:-1)),this.isHoliday()||e--;return this},Date.prototype.distanceInDays=function(t){var e=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()),n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((n-e)/864e5)},Date.prototype.distanceInWorkingDays=function(t){var e=new Date(Math.min(this,t));e.setHours(12,0,0,0);var n=0,r=new Date(Math.max(this,t));for(r.setHours(12,0,0,0);e<r;)n+=isHoliday(e)?0:1,e.setDate(e.getDate()+1);return n*=this>t?-1:1},Date.prototype.setFirstDayOfThisWeek=function(t){return t||(t=Date.firstDayOfWeek),this.setDate(this.getDate()-this.getDay()+t-(0==this.getDay()&&0!=t?7:0)),this};var __popups=[];jQuery.fn.centerOnScreen=function(){return this.each(function(){var t=$(this);t.css("position","fixed"),t.css("top",($(window).height()-t.outerHeight())/2+"px"),t.css("left",($(window).width()-t.outerWidth())/2+"px")})},$.fn.keepItVisible=function(t){var e=$(this).offset().top,n=$(this).offset().left,r=0,a=0,s=$(window).height()+$(window).scrollTop(),i=$(window).width()+$(window).scrollLeft();if(t&&(r=s-t.offset().top,a=i-(t.offset().left+t.outerWidth())),e+$(this).outerHeight()>s){var o=e+$(this).outerHeight()-s;$(this).css("margin-top",-o-r)}if(n+$(this).outerWidth()>i){var l=n+$(this).outerWidth()-i;$(this).css("margin-left",-l-a)}$(this).css("visibility","visible")},$.fn.setCursorPosition=function(t){return this.each(function(e,n){if(n.setSelectionRange)n.setSelectionRange(t,t);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}}),this},$.buttonBar={defaults:{},init:function(){setTimeout(function(){$.buttonBar.manageButtonBar()},100),$(window).on("scroll.ButtonBar",function(){$.buttonBar.manageButtonBar()}),$(window).on("resize.ButtonBar",function(){$.buttonBar.manageButtonBar()})},manageButtonBar:function(t){$(".buttonArea").not(".bbCloned").not(".notFix").each(function(){var t=this;t.originalHeigh=$(t).height(),t.originalOffsetTop=$(t).offset().top,t.isOut=$(window).scrollTop()+$(window).height()-t.originalHeigh<t.originalOffsetTop,t.bbHolder&&t.bbHolder.css({width:$(t).outerWidth(),left:$(t).offset().left}),t.isOut&&!t.isCloned?(t.bbHolder&&t.bbHolder.remove(),t.isCloned=!0,t.bbHolder=$(t).clone().addClass("bbCloned clone bottom").css({width:$(t).outerWidth(),marginTop:0,left:$(t).offset().left}),t.bbHolder.hide(),t.bbHolder.css({position:"fixed",bottom:0,left:$(t).offset().left}),$(t).after(t.bbHolder),t.bbHolder.show(),$(t).css("visibility","hidden")):!t.isOut&&t.isCloned&&(t.isCloned=!1,t.bbHolder.remove(),$(t).css("visibility","visible"))})},refreshButtonBar:function(){$(".bbCloned").remove(),$(".buttonArea").not(".bbCloned").each(function(){this.isCloned=!1}),$.buttonBar.manageButtonBar(!1)}},Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.monthAbbreviations=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.dayAbbreviations=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Date.preferAmericanFormat=!1,Date.firstDayOfWeek=0,Date.defaultFormat="M/d/yyyy",Date.masks={fullDate:"EEEE, MMMM d, yyyy",shortTime:"h:mm a"},Date.today="Today",Number.decimalSeparator=".",Number.groupingSeparator=",",Number.minusSign="-",Number.currencyFormat="###,##0.00";var millisInWorkingDay=288e5,workingDaysPerWeek=5,i18n={YES:"Yes",NO:"No",FLD_CONFIRM_DELETE:"confirm the deletion?",INVALID_DATA:"The data inserted are invalid for the field format.",ERROR_ON_FIELD:"Error on field",OUT_OF_BOUDARIES:"Out of field admitted values:",CLOSE_ALL_CONTAINERS:"close all?",DO_YOU_CONFIRM:"Do you confirm?",ERR_FIELD_MAX_SIZE_EXCEEDED:"Field max size exceeded",WEEK_SHORT:"W.",FILE_TYPE_NOT_ALLOWED:"File type not allowed.",FILE_UPLOAD_COMPLETED:"File upload completed.",UPLOAD_MAX_SIZE_EXCEEDED:"Max file size exceeded",ERROR_UPLOADING:"Error uploading",UPLOAD_ABORTED:"Upload aborted",DROP_HERE:"Drop files here",FORM_IS_CHANGED:"You have some unsaved data on the page!",PIN_THIS_MENU:"PIN_THIS_MENU",UNPIN_THIS_MENU:"UNPIN_THIS_MENU",OPEN_THIS_MENU:"OPEN_THIS_MENU",CLOSE_THIS_MENU:"CLOSE_THIS_MENU",PROCEED:"Proceed?",PREV:"Previous",NEXT:"Next",HINT_SKIP:"Got it, close this hint.",WANT_TO_SAVE_FILTER:"save this filter",NEW_FILTER_NAME:"name of the new filter",SAVE:"Save",DELETE:"Delete",HINT_SKIP:"Got it, close this hint.",COMBO_NO_VALUES:"no values available...?",FILTER_UPDATED:"Filter updated.",FILTER_SAVED:"Filter correctly saved."};jQuery.fn.dateField=function(t){if(!t.inputField)return console.error("You must supply an input field"),!1;if(void 0===t.firstDayOfWeek&&(t.firstDayOfWeek=Date.firstDayOfWeek),void 0===t.useWheel&&(t.useWheel=!0),void 0===t.dateFormat&&(t.dateFormat=Date.defaultFormat),void 0===t.todayLabel&&(t.todayLabel=Date.today),!(t.inputField.is("[readonly]")&&!t.inputField.is(".noFocus")||t.inputField.is("[disabled]"))){var e={currentDate:new Date};e.options=t;var n=this.eq(0),r=$("<div>").addClass("calBox");t.width&&r.css("width",t.width),t.height&&r.css("height",t.height);var a=$("<div>").addClass("calNav"),s=$("<div>").addClass("calDay");if(s.addClass("calFullMonth"),r.append(a).append(s),t.isSearchField){var i=$("<div>").addClass("shortCuts").html("<span title='last quarter'>LQ</span> <span title='last month'>LM</span> <span title='this month'>M</span> <span title='last week'>LW</span> <span title='this week'>W</span> <span title='yesterday'>Y</span> <span title='today'>T</span><span title='tomorrow'>TO</span><span title='next week'>NW</span> <span title='next month'>NM</span> <span title='this quarter'>Q</span> <span title='next quarter'>NQ</span>");i.click(function(n){var r=$(n.target);r.is("span")&&(t.isSearchField?t.inputField.val(r.text().trim()):t.inputField.val(Date.parseString(r.text().trim(),t.dateFormat,!0).format(t.dateFormat)),e.closeCalendar())}),r.append(i)}$("body").is(".mobile")&&enableComponentOverlay(t.inputField,r),$("body").append(r),t.centerOnScreen?r.oneTime(10,"ce",function(){$(this).centerOnScreen()}):nearBestPosition(n,r),r.css("z-index",1e4),$("body").oneTime(100,"regclibodcal",function(){$("body").bind("click.dateField",function(){e.closeCalendar()})}),e.drawCalendar=function(n){e.currentDate=n;if(function(e){var n=new Date;a.empty();var r=t.showToday;if(t.useYears||t.useMonths){if(t.useYears>0){t.useMonths=t.useMonths||1,d=new Date(e.getTime());var s=$("<div class='calYear'>"),i=100/(2*t.useYears+1+(r?1:0));if(d.setFullYear(d.getFullYear()-t.useYears),r){var o=$("<span>").addClass("calElement noCallback goToday").attr("millis",n.getTime()).append(t.todayLabel).css("width",i+"%");r=!1,s.append(o)}for(var l=-t.useYears;l<=t.useYears;l++){var o=$("<span>").addClass("calElement noCallback").attr("millis",d.getTime()).append(d.getFullYear()).css("width",i+"%");n.getFullYear()==d.getFullYear()&&o.addClass("today"),0==l&&o.addClass("selected"),s.append(o),d.setFullYear(d.getFullYear()+1)}a.append(s)}if(t.useMonths>0){d=new Date(e.getTime()),d.setDate(1);var i=100/(2*t.useMonths+1+(r?1:0));d.setMonth(d.getMonth()-t.useMonths);var s=$("<div class='calMonth'>");if(r){var o=$("<span>").addClass("calElement noCallback goToday").attr("millis",n.getTime()).append(t.todayLabel).css("width",i+"%");s.append(o)}for(var l=-t.useMonths;l<=t.useMonths;l++){var o=$("<span>").addClass("calElement noCallback").attr("millis",d.getTime()).append(d.format("MMM")).css("width",i+"%");n.getFullYear()==d.getFullYear()&&n.getMonth()==d.getMonth()&&o.addClass("today"),0==l&&o.addClass("selected"),s.append(o),d.setMonth(d.getMonth()+1)}a.append(s)}}else{var d=new Date(e.getTime());d.setDate(1),d.setMonth(d.getMonth()-1);var h=$("<span>").addClass("calElement noCallback prev").attr("millis",d.getTime()),u=$("<span>").addClass("calElement noCallback goToday").attr("millis",(new Date).getTime()).attr("title","today");d.setMonth(d.getMonth()+1);var c=$("<span>").html(d.format("MMMM yyyy"));d.setMonth(d.getMonth()+1);var f=$("<span>").addClass("calElement noCallback next").attr("millis",d.getTime());a.append(h,u,c,f)}}(n),function(e){s.empty();var n=new Date,r=new Date(e);r.setFirstDayOfThisWeek(t.firstDayOfWeek);for(var a=0;a<7;a++){var i=$("<span>").addClass("calDayHeader").attr("day",r.getDay());r.isHoliday()&&i.addClass("holy"),i.css("width",100/7+"%"),i.html(Date.dayAbbreviations[r.getDay()]),"function"==typeof t.dayHeaderRenderer&&t.dayHeaderRenderer(i,r.getDay()),s.append(i),r.setDate(r.getDate()+1)}r=new Date(e),r.setDate(1),r.setFirstDayOfThisWeek(t.firstDayOfWeek);for(var a=0;r.getMonth()<=e.getMonth()&&r.getFullYear()<=e.getFullYear()||r.getFullYear()<e.getFullYear()||a%7!=0;){var i=$("<span>").addClass("calElement day").attr("millis",r.getTime());i.html("<span class=dayNumber>"+r.getDate()+"</span>").css("width",100/7+"%"),r.getYear()==n.getYear()&&r.getMonth()==n.getMonth()&&r.getDate()==n.getDate()&&i.addClass("today"),r.getYear()==e.getYear()&&r.getMonth()==e.getMonth()&&r.getDate()==e.getDate()&&i.addClass("selected"),r.isHoliday()&&i.addClass("holy"),r.getMonth()!=e.getMonth()&&i.addClass("calOutOfScope"),"function"==typeof t.dayRenderer&&t.dayRenderer(i,r),s.append(i),r.setDate(r.getDate()+1),a++}}(n),t.notBeforeMillis||t.notAfterMillis){var r=t.notBeforeMillis?t.notBeforeMillis:Number.MIN_VALUE,i=t.notAfterMillis?t.notAfterMillis:Number.MAX_VALUE;s.find(".calElement[millis]").each(function(){var t=$(this),e=parseInt(t.attr("millis"));(e>i||e<r)&&t.addClass("disabled")})}},e.closeCalendar=function(){$("body").is(".mobile")&&disableComponentOverlay(),r.remove(),$("body").unbind("click.dateField")},r.click(function(n){var r=$(n.target).closest(".calElement");if(r.length>0){var a=parseInt(r.attr("millis")),s=new Date(a);if(r.is(".disabled"))return void n.stopPropagation();r.hasClass("day")?(e.closeCalendar(),r.is(".noCallback")||(t.inputField.val(s.format(t.dateFormat)).attr("millis",s.getTime()).focus(),"function"==typeof t.callback&&t.callback.apply(t.inputField,[s]))):e.drawCalendar(s)}n.stopPropagation()}),$.event.special.mousewheel&&t.useWheel&&s.mousewheel(function(t,n){var r=new Date(e.currentDate.getTime());return r.setMonth(r.getMonth()+n),e.drawCalendar(r),!1});var o=t.inputField.val();if(o&&Date.isValid(o,t.dateFormat,!0)){var l=Date.parseString(o,t.dateFormat,!0),d=l.format(t.dateFormat);t.isSearchField||(t.inputField.attr("millis",l.getTime()),o!=d&&t.inputField.val(d)),e.drawCalendar(l)}else e.drawCalendar(new Date);return e}},$.fn.loadTemplates=function(){return $.JST.loadTemplates($(this)),this},$.JST={_templates:new Object,_decorators:new Object,loadTemplates:function(t){t.each(function(){$(this).find(".__template__").each(function(){for(var t=$(this),e=t.attr("type"),n=!1,r=t.get(0).firstChild;r&&!n;){if(8==r.nodeType){var a=r.nodeValue;n=!0;break}r=r.nextSibling}if(!n)var a=t.html();if(a.match(/##\w+##/))try{$.JST._templates[e]=a}catch(t){console.error("JST error: "+e,t,a)}else{var s="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").replace(/'(?=[^#]*#\))/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/\(#=(.+?)#\)/g,"',$1,'").split("(#").join("');").split("#)").join("p.push('")+"');}return p.join('');";try{$.JST._templates[e]=new Function("obj",s)}catch(t){console.error("JST error: "+e,t,s)}}t.remove()})})},createFromTemplate:function(t,e,n){var r=$.JST._templates,a=new Object;if(n)for(var s in t){var i=t[s];"string"==typeof i&&(i=(i+"").replace(/\n/g,"<br>")),a[s]=i}else a=t;var o="";if(void 0===e)alert("Template is required"),o="<div>Template is required</div>";else if("function"==typeof r[e])try{o=r[e](a)}catch(t){console.error("JST error: "+e,t.message),o="<div> ERROR: "+e+"<br>"+t.message+"</div>"}else{if(!(o=r[e])||""==o.trim())return console.error("No template found for type '"+e+"'"),$("<div>");o=function(t,e){for(var n in e){var r=e[n];t=t.replace(new RegExp("##"+n+"##","gi"),r)}return t=t.replace(new RegExp("##\\w+##","gi"),"")}(o,a)}var l=$(o);l.attr("__template",e);var d=$.JST._decorators[e];return"function"==typeof d&&d(l,a),l},existsTemplate:function(t){return $.JST._templates[t]},loadDecorator:function(t,e){$.JST._decorators[t]=e},getDecorator:function(t){return $.JST._decorators[t]},decorateTemplate:function(t){var e=$.JST._decorators[t.attr("__template")];"function"==typeof e&&e(editor)},ajaxLoadAsynchTemplates:function(t,e){$.get(t,function(t){var n=$("<div>");n.html(t),$.JST.loadTemplates(n),e()},"html")},ajaxLoadTemplates:function(t){$.ajax({async:!1,url:t,dataType:"html",success:function(t){var e=$("<div>");e.html(t),$.JST.loadTemplates(e)}})}},function(t){function e(){this._settings=[],this._extensions=[],this.regional=[],this.regional[""]={errorLoadingText:"Error loading",notSupportedText:"This browser does not support SVG"},this.local=this.regional[""],this._uuid=(new Date).getTime(),this._renesis=n("RenesisX.RenesisCtrl")}function n(t){try{return!(!window.ActiveXObject||!new ActiveXObject(t))}catch(t){return!1}}function r(e,n){this._svg=e,this._container=n;for(var r=0;r<t.svg._extensions.length;r++){var a=t.svg._extensions[r];this[a[0]]=new a[1](this)}}function a(){this._path=""}function s(){this._parts=[]}function i(t){return t&&t.constructor==Array}var o="svgwrapper";t.extend(e.prototype,{markerClassName:"hasSVG",svgNS:"http://www.w3.org/2000/svg",xlinkNS:"http://www.w3.org/1999/xlink",_wrapperClass:r,_attrNames:{class_:"class",in_:"in",alignmentBaseline:"alignment-baseline",baselineShift:"baseline-shift",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",underlinePosition:"underline-position",underlineThickness:"underline-thickness",vertAdvY:"vert-adv-y",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"},_attachSVG:function(e,n){var r=e.namespaceURI==this.svgNS?e:null,e=r?null:e;if(!t(e||r).hasClass(this.markerClassName)){"string"==typeof n?n={loadURL:n}:"function"==typeof n&&(n={onLoad:n}),t(e||r).addClass(this.markerClassName);try{r||(r=document.createElementNS(this.svgNS,"svg"),r.setAttribute("version","1.1"),e.clientWidth>0&&r.setAttribute("width",e.clientWidth),e.clientHeight>0&&r.setAttribute("height",e.clientHeight),e.appendChild(r)),this._afterLoad(e,r,n||{})}catch(r){t.browser.msie?(e.id||(e.id="svg"+this._uuid++),this._settings[e.id]=n,e.innerHTML='<embed type="image/svg+xml" width="100%" height="100%" src="'+(n.initPath||"")+'blank.svg" pluginspage="http://www.adobe.com/svg/viewer/install/main.html"/>'):e.innerHTML='<p class="svg_error">'+this.local.notSupportedText+"</p>"}}},_registerSVG:function(){for(var e=0;e<document.embeds.length;e++){var n=document.embeds[e].parentNode;if(t(n).hasClass(t.svg.markerClassName)&&!t.data(n,o)){var r=null;try{r=document.embeds[e].getSVGDocument()}catch(e){return void setTimeout(t.svg._registerSVG,250)}r=r?r.documentElement:null,r&&t.svg._afterLoad(n,r)}}},_afterLoad:function(e,n,r){var r=r||this._settings[e.id];this._settings[e?e.id:""]=null;var a=new this._wrapperClass(n,e);t.data(e||n,o,a);try{r.loadURL&&a.load(r.loadURL,r),r.settings&&a.configure(r.settings),r.onLoad&&!r.loadURL&&r.onLoad.apply(e||n,[a])}catch(t){alert(t)}},_getSVG:function(e){return e="string"==typeof e?t(e)[0]:e.jquery?e[0]:e,t.data(e,o)},_destroySVG:function(e){var n=t(e);n.hasClass(this.markerClassName)&&(n.removeClass(this.markerClassName),e.namespaceURI!=this.svgNS&&n.empty(),t.removeData(e,o))},addExtension:function(t,e){this._extensions.push([t,e])},isSVGElem:function(e){return 1==e.nodeType&&e.namespaceURI==t.svg.svgNS}}),t.extend(r.prototype,{_width:function(){return this._container?this._container.clientWidth:this._svg.width},_height:function(){return this._container?this._container.clientHeight:this._svg.height},root:function(){return this._svg},configure:function(e,n,r){if(e.nodeName||(r=n,n=e,e=this._svg),r)for(var a=e.attributes.length-1;a>=0;a--){var s=e.attributes.item(a);"onload"!=s.nodeName&&"version"!=s.nodeName&&"xmlns"!=s.nodeName.substring(0,5)&&e.attributes.removeNamedItem(s.nodeName)}for(var i in n)e.setAttribute(t.svg._attrNames[i]||i,n[i]);return this},getElementById:function(t){return this._svg.ownerDocument.getElementById(t)},change:function(e,n){if(e)for(var r in n)null==n[r]?e.removeAttribute(t.svg._attrNames[r]||r):e.setAttribute(t.svg._attrNames[r]||r,n[r]);return this},_args:function(e,n,r){n.splice(0,0,"parent"),n.splice(n.length,0,"settings");var a={},s=0;null!=e[0]&&e[0].jquery&&(e[0]=e[0][0]),null==e[0]||"object"==typeof e[0]&&e[0].nodeName||(a.parent=null,s=1);for(var i=0;i<e.length;i++)a[n[i+s]]=e[i];return r&&t.each(r,function(t,e){"object"==typeof a[e]&&(a.settings=a[e],a[e]=null)}),a},title:function(t,e,n){var r=this._args(arguments,["text"]),a=this._makeNode(r.parent,"title",r.settings||{});return a.appendChild(this._svg.ownerDocument.createTextNode(r.text)),a},describe:function(t,e,n){var r=this._args(arguments,["text"]),a=this._makeNode(r.parent,"desc",r.settings||{});return a.appendChild(this._svg.ownerDocument.createTextNode(r.text)),a},defs:function(e,n,r){var a=this._args(arguments,["id"],["id"]);return this._makeNode(a.parent,"defs",t.extend(a.id?{id:a.id}:{},a.settings||{}))},symbol:function(e,n,r,a,s,i,o){var l=this._args(arguments,["id","x1","y1","width","height"]);return this._makeNode(l.parent,"symbol",t.extend({id:l.id,viewBox:l.x1+" "+l.y1+" "+l.width+" "+l.height},l.settings||{}))},marker:function(e,n,r,a,s,i,o,l){var d=this._args(arguments,["id","refX","refY","mWidth","mHeight","orient"],["orient"]);return this._makeNode(d.parent,"marker",t.extend({id:d.id,refX:d.refX,refY:d.refY,markerWidth:d.mWidth,markerHeight:d.mHeight,orient:d.orient||"auto"},d.settings||{}))},style:function(e,n,r){var a=this._args(arguments,["styles"]),s=this._makeNode(a.parent,"style",t.extend({type:"text/css"},a.settings||{}));return s.appendChild(this._svg.ownerDocument.createTextNode(a.styles)),t.browser.opera&&t("head").append('<style type="text/css">'+a.styles+"</style>"),s},script:function(e,n,r,a){var s=this._args(arguments,["script","type"],["type"]),i=this._makeNode(s.parent,"script",t.extend({type:s.type||"text/javascript"},s.settings||{}));return i.appendChild(this._svg.ownerDocument.createTextNode(s.script)),t.browser.mozilla||t.globalEval(s.script),i},linearGradient:function(e,n,r,a,s,i,o,l){var d=this._args(arguments,["id","stops","x1","y1","x2","y2"],["x1"]),h=t.extend({id:d.id},null!=d.x1?{x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2}:{});return this._gradient(d.parent,"linearGradient",t.extend(h,d.settings||{}),d.stops)},radialGradient:function(e,n,r,a,s,i,o,l,d){var h=this._args(arguments,["id","stops","cx","cy","r","fx","fy"],["cx"]),u=t.extend({id:h.id},null!=h.cx?{cx:h.cx,cy:h.cy,r:h.r,fx:h.fx,fy:h.fy}:{});return this._gradient(h.parent,"radialGradient",t.extend(u,h.settings||{}),h.stops)},_gradient:function(e,n,r,a){for(var s=this._makeNode(e,n,r),i=0;i<a.length;i++){var o=a[i];this._makeNode(s,"stop",t.extend({offset:o[0],stopColor:o[1]},null!=o[2]?{stopOpacity:o[2]}:{}))}return s},pattern:function(e,n,r,a,s,i,o,l,d,h,u){var c=this._args(arguments,["id","x","y","width","height","vx","vy","vwidth","vheight"],["vx"]),f=t.extend({id:c.id,x:c.x,y:c.y,width:c.width,height:c.height},null!=c.vx?{viewBox:c.vx+" "+c.vy+" "+c.vwidth+" "+c.vheight}:{});return this._makeNode(c.parent,"pattern",t.extend(f,c.settings||{}))},clipPath:function(e,n,r,a){var s=this._args(arguments,["id","units"]);return s.units=s.units||"userSpaceOnUse",this._makeNode(s.parent,"clipPath",t.extend({id:s.id,clipPathUnits:s.units},s.settings||{}))},mask:function(e,n,r,a,s,i,o){var l=this._args(arguments,["id","x","y","width","height"]);return this._makeNode(l.parent,"mask",t.extend({id:l.id,x:l.x,y:l.y,width:l.width,height:l.height},l.settings||{}))},createPath:function(){return new a},createText:function(){return new s},svg:function(e,n,r,a,s,i,o,l,d,h){var u=this._args(arguments,["x","y","width","height","vx","vy","vwidth","vheight"],["vx"]),c=t.extend({x:u.x,y:u.y,width:u.width,height:u.height},null!=u.vx?{viewBox:u.vx+" "+u.vy+" "+u.vwidth+" "+u.vheight}:{});return this._makeNode(u.parent,"svg",t.extend(c,u.settings||{}))},group:function(e,n,r){var a=this._args(arguments,["id"],["id"]);return this._makeNode(a.parent,"g",t.extend({id:a.id},a.settings||{}))},use:function(e,n,r,a,s,i,o){var l=this._args(arguments,["x","y","width","height","ref"]);"string"==typeof l.x&&(l.ref=l.x,l.settings=l.y,l.x=l.y=l.width=l.height=null);var d=this._makeNode(l.parent,"use",t.extend({x:l.x,y:l.y,width:l.width,height:l.height},l.settings||{}));return d.setAttributeNS(t.svg.xlinkNS,"href",l.ref),d},link:function(e,n,r){var a=this._args(arguments,["ref"]),s=this._makeNode(a.parent,"a",a.settings);return s.setAttributeNS(t.svg.xlinkNS,"href",a.ref),s},image:function(e,n,r,a,s,i,o){var l=this._args(arguments,["x","y","width","height","ref"]),d=this._makeNode(l.parent,"image",t.extend({x:l.x,y:l.y,width:l.width,height:l.height},l.settings||{}));return d.setAttributeNS(t.svg.xlinkNS,"href",l.ref),d},path:function(e,n,r){var a=this._args(arguments,["path"]);return this._makeNode(a.parent,"path",t.extend({d:a.path.path?a.path.path():a.path},a.settings||{}))},rect:function(e,n,r,a,s,i,o,l){var d=this._args(arguments,["x","y","width","height","rx","ry"],["rx"]);return this._makeNode(d.parent,"rect",t.extend({x:d.x,y:d.y,width:d.width,height:d.height},d.rx?{rx:d.rx,ry:d.ry}:{},d.settings||{}))},circle:function(e,n,r,a,s){var i=this._args(arguments,["cx","cy","r"]);return this._makeNode(i.parent,"circle",t.extend({cx:i.cx,cy:i.cy,r:i.r},i.settings||{}))},ellipse:function(e,n,r,a,s,i){var o=this._args(arguments,["cx","cy","rx","ry"]);return this._makeNode(o.parent,"ellipse",t.extend({cx:o.cx,cy:o.cy,rx:o.rx,ry:o.ry},o.settings||{}))},line:function(e,n,r,a,s,i){var o=this._args(arguments,["x1","y1","x2","y2"]);return this._makeNode(o.parent,"line",t.extend({x1:o.x1,y1:o.y1,x2:o.x2,y2:o.y2},o.settings||{}))},polyline:function(t,e,n){var r=this._args(arguments,["points"]);return this._poly(r.parent,"polyline",r.points,r.settings)},polygon:function(t,e,n){var r=this._args(arguments,["points"]);return this._poly(r.parent,"polygon",r.points,r.settings)},_poly:function(e,n,r,a){for(var s="",i=0;i<r.length;i++)s+=r[i].join()+" ";return this._makeNode(e,n,t.extend({points:t.trim(s)},a||{}))},text:function(e,n,r,a,s){var o=this._args(arguments,["x","y","value"]);return"string"==typeof o.x&&arguments.length<4&&(o.value=o.x,o.settings=o.y,o.x=o.y=null),this._text(o.parent,"text",o.value,t.extend({x:o.x&&i(o.x)?o.x.join(" "):o.x,y:o.y&&i(o.y)?o.y.join(" "):o.y},o.settings||{}))},textpath:function(e,n,r,a){var s=this._args(arguments,["path","value"]),i=this._text(s.parent,"textPath",s.value,s.settings||{});return i.setAttributeNS(t.svg.xlinkNS,"href",s.path),i},_text:function(e,n,r,a){var s=this._makeNode(e,n,a);if("string"==typeof r)s.appendChild(s.ownerDocument.createTextNode(r));else for(var i=0;i<r._parts.length;i++){var o=r._parts[i];if("tspan"==o[0]){var l=this._makeNode(s,o[0],o[2]);l.appendChild(s.ownerDocument.createTextNode(o[1])),s.appendChild(l)}else if("tref"==o[0]){var l=this._makeNode(s,o[0],o[2]);l.setAttributeNS(t.svg.xlinkNS,"href",o[1]),s.appendChild(l)}else if("textpath"==o[0]){var d=t.extend({},o[2]);d.href=null;var l=this._makeNode(s,o[0],d);l.setAttributeNS(t.svg.xlinkNS,"href",o[2].href),l.appendChild(s.ownerDocument.createTextNode(o[1])),s.appendChild(l)}else s.appendChild(s.ownerDocument.createTextNode(o[1]))}return s},other:function(t,e,n){var r=this._args(arguments,["name"]);return this._makeNode(r.parent,r.name,r.settings||{})},_makeNode:function(e,n,r){e=e||this._svg;var a=this._svg.ownerDocument.createElementNS(t.svg.svgNS,n);for(var n in r){var s=r[n];null==s||null==s||"string"==typeof s&&""==s||a.setAttribute(t.svg._attrNames[n]||n,s)}return e.appendChild(a),a},add:function(e,n){var r=this._args(1==arguments.length?[null,e]:arguments,["node"]),a=this;r.parent=r.parent||this._svg,r.node=r.node.jquery?r.node:t(r.node);try{if(t.svg._renesis)throw"Force traversal";r.parent.appendChild(r.node.cloneNode(!0))}catch(t){r.node.each(function(){var t=a._cloneAsSVG(this);t&&r.parent.appendChild(t)})}return this},clone:function(e,n){var r=this,a=this._args(1==arguments.length?[null,e]:arguments,["node"]);a.parent=a.parent||this._svg,a.node=a.node.jquery?a.node:t(a.node);var s=[];return a.node.each(function(){var t=r._cloneAsSVG(this);t&&(t.id="",a.parent.appendChild(t),s.push(t))}),s},_cloneAsSVG:function(e){var n=null;if(1==e.nodeType){n=this._svg.ownerDocument.createElementNS(t.svg.svgNS,this._checkName(e.nodeName));for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);"xmlns"!=a.nodeName&&a.nodeValue&&("xlink"==a.prefix?n.setAttributeNS(t.svg.xlinkNS,a.localName||a.baseName,a.nodeValue):n.setAttribute(this._checkName(a.nodeName),a.nodeValue))}for(var r=0;r<e.childNodes.length;r++){var s=this._cloneAsSVG(e.childNodes[r]);s&&n.appendChild(s)}}else if(3==e.nodeType)t.trim(e.nodeValue)&&(n=this._svg.ownerDocument.createTextNode(e.nodeValue));else if(4==e.nodeType&&t.trim(e.nodeValue))try{n=this._svg.ownerDocument.createCDATASection(e.nodeValue)}catch(t){n=this._svg.ownerDocument.createTextNode(e.nodeValue.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}return n},_checkName:function(t){return t=t.substring(0,1)>="A"&&t.substring(0,1)<="Z"?t.toLowerCase():t,"svg:"==t.substring(0,4)?t.substring(4):t},load:function(e,n){n="boolean"==typeof n?{addTo:n}:"function"==typeof n?{onLoad:n}:"string"==typeof n?{parent:n}:"object"==typeof n&&n.nodeName?{parent:n}:"object"==typeof n&&n.jquery?{parent:n}:n||{},n.parent||n.addTo||this.clear(!1);var r=[this._svg.getAttribute("width"),this._svg.getAttribute("height")],a=this,s=function(e){e=t.svg.local.errorLoadingText+": "+e,n.onLoad?n.onLoad.apply(a._container||a._svg,[a,e]):a.text(null,10,20,e)},i=function(t){var e=new ActiveXObject("Microsoft.XMLDOM");return e.validateOnParse=!1,e.resolveExternals=!1,e.async=!1,e.loadXML(t),0!=e.parseError.errorCode?(s(e.parseError.reason),null):e},o=function(e){if(e){if("svg"!=e.documentElement.nodeName){var i=e.getElementsByTagName("parsererror"),o=i.length?i[0].getElementsByTagName("div"):[];return void s(i.length?(o.length?o[0]:i[0]).firstChild.nodeValue:"???")}for(var l=n.parent?t(n.parent)[0]:a._svg,d={},h=0;h<e.documentElement.attributes.length;h++){var u=e.documentElement.attributes.item(h);"version"!=u.nodeName&&"xmlns"!=u.nodeName.substring(0,5)&&(d[u.nodeName]=u.nodeValue)}a.configure(l,d,!n.parent);for(var c=e.documentElement.childNodes,h=0;h<c.length;h++)try{if(t.svg._renesis)throw"Force traversal";l.appendChild(a._svg.ownerDocument.importNode(c[h],!0)),"script"==c[h].nodeName&&t.globalEval(c[h].textContent)}catch(t){a.add(l,c[h])}n.changeSize||a.configure(l,{width:r[0],height:r[1]}),n.onLoad&&n.onLoad.apply(a._container||a._svg,[a])}};return e.match("<svg")?o(t.browser.msie?i(e):(new DOMParser).parseFromString(e,"text/xml")):t.ajax({url:e,dataType:t.browser.msie?"text":"xml",success:function(e){o(t.browser.msie?i(e):e)},error:function(t,e,n){s(e+(n?" "+n.message:""))}}),this},remove:function(t){return t=t.jquery?t[0]:t,t.parentNode.removeChild(t),this},clear:function(t){for(t&&this.configure({},!0);this._svg.firstChild;)this._svg.removeChild(this._svg.firstChild);return this},toSVG:function(t){return t=t||this._svg,"undefined"==typeof XMLSerializer?this._toSVG(t):(new XMLSerializer).serializeToString(t)},_toSVG:function(e){var n="";if(!e)return n;if(3==e.nodeType)n=e.nodeValue;else if(4==e.nodeType)n="<![CDATA["+e.nodeValue+"]]>";else{if(n="<"+e.nodeName,e.attributes)for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);""==t.trim(a.nodeValue)||a.nodeValue.match(/^\[object/)||a.nodeValue.match(/^function/)||(n+=" "+(a.namespaceURI==t.svg.xlinkNS?"xlink:":"")+a.nodeName+'="'+a.nodeValue+'"')}if(e.firstChild){n+=">";for(var s=e.firstChild;s;)n+=this._toSVG(s),s=s.nextSibling;n+="</"+e.nodeName+">"}else n+="/>"}return n}}),t.extend(a.prototype,{reset:function(){return this._path="",this},move:function(t,e,n){return n=i(t)?e:n,this._coords(n?"m":"M",t,e)},line:function(t,e,n){return n=i(t)?e:n,this._coords(n?"l":"L",t,e)},horiz:function(t,e){return this._path+=(e?"h":"H")+(i(t)?t.join(" "):t),this},vert:function(t,e){return this._path+=(e?"v":"V")+(i(t)?t.join(" "):t),this},curveC:function(t,e,n,r,a,s,o){return o=i(t)?e:o,this._coords(o?"c":"C",t,e,n,r,a,s)},smoothC:function(t,e,n,r,a){return a=i(t)?e:a,this._coords(a?"s":"S",t,e,n,r)},curveQ:function(t,e,n,r,a){return a=i(t)?e:a,this._coords(a?"q":"Q",t,e,n,r)},smoothQ:function(t,e,n){return n=i(t)?e:n,this._coords(n?"t":"T",t,e)},_coords:function(t,e,n,r,a,s,o){if(i(e))for(var l=0;l<e.length;l++){var d=e[l];this._path+=(0==l?t:" ")+d[0]+","+d[1]+(d.length<4?"":" "+d[2]+","+d[3]+(d.length<6?"":" "+d[4]+","+d[5]))}else this._path+=t+e+","+n+(null==r?"":" "+r+","+a+(null==s?"":" "+s+","+o));return this},arc:function(t,e,n,r,a,s,o,l){if(l=i(t)?e:l,this._path+=l?"a":"A",i(t))for(var d=0;d<t.length;d++){var h=t[d];this._path+=(0==d?"":" ")+h[0]+","+h[1]+" "+h[2]+" "+(h[3]?"1":"0")+","+(h[4]?"1":"0")+" "+h[5]+","+h[6]}else this._path+=t+","+e+" "+n+" "+(r?"1":"0")+","+(a?"1":"0")+" "+s+","+o;return this},close:function(){return this._path+="z",this},path:function(){return this._path}}),a.prototype.moveTo=a.prototype.move,a.prototype.lineTo=a.prototype.line,a.prototype.horizTo=a.prototype.horiz,a.prototype.vertTo=a.prototype.vert,a.prototype.curveCTo=a.prototype.curveC,a.prototype.smoothCTo=a.prototype.smoothC,a.prototype.curveQTo=a.prototype.curveQ,a.prototype.smoothQTo=a.prototype.smoothQ,a.prototype.arcTo=a.prototype.arc,t.extend(s.prototype,{reset:function(){return this._parts=[],this},string:function(t){return this._parts[this._parts.length]=["text",t],this},span:function(t,e){return this._parts[this._parts.length]=["tspan",t,e],this},ref:function(t,e){return this._parts[this._parts.length]=["tref",t,e],this},path:function(e,n,r){return this._parts[this._parts.length]=["textpath",n,t.extend({href:e},r||{})],this}}),t.fn.svg=function(e){var n=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&"get"==e?t.svg["_"+e+"SVG"].apply(t.svg,[this[0]].concat(n)):this.each(function(){"string"==typeof e?t.svg["_"+e+"SVG"].apply(t.svg,[this].concat(n)):t.svg._attachSVG(this,e||{})})},t.svg=new e}(jQuery),function(t){var e=/[\t\r\n]/g,n=/\s+/;t.fn.addClass=function(e){return function(e){var r,a,s,i,o,l,d;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(r=e.split(n),a=0,s=this.length;a<s;a++)if(i=this[a],1===i.nodeType)if(i.className&&i.getAttribute("class")||1!==r.length){for(o=t.svg.isSVGElem(i)?i.className?i.className.baseVal:i.getAttribute("class"):i.className,o=" "+o+" ",l=0,d=r.length;l<d;l++)o.indexOf(" "+r[l]+" ")<0&&(o+=r[l]+" ");o=jQuery.trim(o),t.svg.isSVGElem(i)?i.className?i.className.baseVal=o:i.setAttribute("class",o):i.className=o}else t.svg.isSVGElem(i)?i.className?i.className.baseVal=e:i.setAttribute("class",e):i.className=e;return this}}(t.fn.addClass),t.fn.removeClass=function(r){return function(r){var a,s,i,o,l,d,h;if(jQuery.isFunction(r))return this.each(function(t){jQuery(this).removeClass(r.call(this,t,this.className))});if(r&&"string"==typeof r||void 0===r)for(a=(r||"").split(n),s=0,i=this.length;s<i;s++)if(o=this[s],1===o.nodeType&&(o.className||o.getAttribute("class"))){if(r){for(l=t.svg.isSVGElem(o)?o.className?o.className.baseVal:o.getAttribute("class"):o.className,l=(" "+l+" ").replace(e," "),d=0,h=a.length;d<h;d++)for(;l.indexOf(" "+a[d]+" ")>=0;)l=l.replace(" "+a[d]+" "," ");l=jQuery.trim(l)}else l="";t.svg.isSVGElem(o)?o.className?o.className.baseVal=l:o.setAttribute("class",l):o.className=l}return this}}(t.fn.removeClass),t.fn.toggleClass=function(e){return function(n,r){return this.each(function(){t.svg.isSVGElem(this)?("boolean"!=typeof r&&(r=!t(this).hasClass(n)),t(this)[(r?"add":"remove")+"Class"](n)):e.apply(t(this),[n,r])})}}(t.fn.toggleClass),t.fn.hasClass=function(n){return function(n){for(var r,a,s=" "+n+" ",i=0,o=this.length;i<o;i++)if(r=this[i],1===r.nodeType&&(a=t.svg.isSVGElem(r)?r.className?r.className.baseVal:r.getAttribute("class"):r.className,(" "+a+" ").replace(e," ").indexOf(s)>-1))return!0;return!1}}(t.fn.hasClass),t.fn.attr=function(e){return function(n,r,a){var s=arguments;if("string"==typeof n&&void 0===r){var i=e.apply(this,s);if(i&&i.baseVal&&null!=i.baseVal.numberOfItems)if(r="",i=i.baseVal,"transform"==n){for(var o=0;o<i.numberOfItems;o++){var l=i.getItem(o);switch(l.type){case 1:r+=" matrix("+l.matrix.a+","+l.matrix.b+","+l.matrix.c+","+l.matrix.d+","+l.matrix.e+","+l.matrix.f+")";break;case 2:r+=" translate("+l.matrix.e+","+l.matrix.f+")";break;case 3:r+=" scale("+l.matrix.a+","+l.matrix.d+")";break;case 4:r+=" rotate("+l.angle+")";break;case 5:r+=" skewX("+l.angle+")";break;case 6:r+=" skewY("+l.angle+")"}}i=r.substring(1)}else i=i.getItem(0).valueAsString;return i&&i.baseVal?i.baseVal.valueAsString:i}var d=n;return"string"==typeof n&&(d={},d[n]=r),t(this).each(function(){if(t.svg.isSVGElem(this))for(var n in d){var r=t.isFunction(d[n])?d[n]():d[n];a?this.style[n]=r:this.setAttribute(n,r)}else e.apply(t(this),s)})}}(t.fn.attr),t.fn.removeAttr=function(e){return function(n){return this.each(function(){t.svg.isSVGElem(this)?this[n]&&this[n].baseVal?this[n].baseVal.value="":this.setAttribute(n,""):e.apply(t(this),[n])})}}(t.fn.removeAttr),t.extend(t.cssNumber,{stopOpacity:!0,strokeMitrelimit:!0,strokeOpacity:!0}),t.cssProps&&(t.css=function(e){return function(n,r,a,s){return(r.match(/^svg.*/)?t(n).attr(t.cssProps[r]||r):"")||e(n,r,a,s)}}(t.css)),t.find.isXML=function(e){return function(n){return t.svg.isSVGElem(n)||e(n)}}(t.find.isXML);var r=document.createElement("div");r.appendChild(document.createComment("")),r.getElementsByTagName("*").length>0&&(t.expr.find.TAG=function(t,e){var n=e.getElementsByTagName(t[1]);if("*"===t[1]){for(var r=[],a=0;n[a]||n.item(a);a++)1===(n[a]||n.item(a)).nodeType&&r.push(n[a]||n.item(a));n=r}return n}),t.expr.filter.CLASS=function(e){var n=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"([\\x20\\t\\r\\n\\f]|$)");return function(e){var r=t.svg.isSVGElem(e)?e.className?e.className.baseVal:e.getAttribute("class"):e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"";return n.test(r)}}}(jQuery),$.gridify=function(t,e){function n(){if(localStorage){var t={},e=[];$(".gdfTable .gdfColHeader").each(function(){e.push($(this).outerWidth())}),t.colSizes=e,localStorage.setObject("TWPGanttGridState",t)}}var r={resizeZoneWidth:10};$.extend(r,e);var a=$("<div>").addClass("gdfWrapper");a.append(t);var s=t.clone();s.addClass("table ganttFixHead"),s.find("tbody").remove(),a.append(s),a.append(t);for(var i=s.find(".gdfColHeader"),o=t.find(".gdfColHeader"),l=0;l<i.length;l++)i.eq(l).data("fTh",o.eq(l));return t.width(0),s.width(0),s.find("th.gdfColHeader:not(.gdfied)").mouseover(function(){$(this).addClass("gdfColHeaderOver")}).on("mouseout.gdf",function(){$(this).removeClass("gdfColHeaderOver"),$.gridify.columInResize||$("body").removeClass("gdfHResizing")}).on("mousemove.gdf",function(t){if(!$.gridify.columInResize){var e=$(this),n=e.next();if(n.length>0&&n.width()<r.resizeZoneWidth&&(e=n),!e.is(".gdfResizable"))return;var a=t.pageX-e.offset().left;e.width()-a<r.resizeZoneWidth?$("body").addClass("gdfHResizing"):$("body").removeClass("gdfHResizing")}}).on("mousedown.gdf",function(t){var e=$(this),a=e.next();if(a.length>0&&a.width()<r.resizeZoneWidth&&(e=a),e.is(".gdfResizable")){var s=t.pageX-e.offset().left;e.width()-s<r.resizeZoneWidth&&($("body").unselectable(),$.gridify.columInResize=e,$(document).on("mousemove.gdf",function(t){t.preventDefault(),$("body").addClass("gdfHResizing");var e=t.pageX-$.gridify.columInResize.offset().left;e=e<=1?1:e,$.gridify.columInResize.width(e),$.gridify.columInResize.data("fTh").width(e)}).on("mouseup.gdf",function(){$(this).off("mousemove.gdf").off("mouseup.gdf").clearUnselectable(),$("body").removeClass("gdfHResizing"),delete $.gridify.columInResize,n()}))}}).on("dblclick.gdf",function(){var e=$(this);if(e.is(".gdfResizable")){var r=$("th",e.parents("table")).index(e),a=$("td:nth-child("+(r+1)+")",t),s=0;return a.each(function(){var t=$(this),e=t.children("input").length?t.children("input").val():t.html(),n=$("<div/>").addClass("columnWidthTest").html(e).css({position:"absolute"});$("body").append(n),s=Math.max(s,n.width()+parseFloat(t.css("padding-left"))),n.remove()}),s+=5,e.width(s),e.data("fTh").width(s),n(),!1}}).addClass("gdfied unselectable").attr("unselectable","true"),function(){if(localStorage&&localStorage.getObject("TWPGanttGridState")){var t=localStorage.getObject("TWPGanttGridState");t.colSizes&&a.find(".gdfTable .gdfColHeader").each(function(e){$(this).width(t.colSizes[e])})}}(),a},$.splittify={init:function(t,e,n,r){function a(t,e,n,r){this.element=t,this.firstBox=e,this.secondBox=n,this.splitterBar=r,this.perc=0,this.firstBoxMinWidth=0,this.secondBoxMinWidth=30,this.resize=function(t,e){var n=e||0;this.perc=t||this.perc;var r=this.element.width(),a=this.splitterBar.width(),i=r*this.perc/100;i=i>this.firstBoxMinWidth?i:this.firstBoxMinWidth,i=i>r-a-h.secondBoxMinWidth?r-a-h.secondBoxMinWidth:i,this.firstBox.animate({width:i},n,function(){$(this).css("overflow-x","auto")}),this.splitterBar.animate({left:i},n),this.secondBox.animate({left:i+this.splitterBar.width(),width:r-i-a},n,function(){$(this).css("overflow","auto")}),s()};var a=this;this.splitterBar.on("dblclick",function(){a.resize(50,!0)})}function s(){localStorage&&localStorage.setItem("TWPGanttSplitPos",h.perc)}var i=$("<div>").addClass("splitterContainer"),o=$("<div>").addClass("splitElement splitBox1"),l=$("<div>").addClass("splitElement vSplitBar").attr("unselectable","on").css("padding-top",t.height()/2+"px"),d=$("<div>").addClass("splitElement splitBox2"),h=new a(i,o,d,l);h.perc=r,function(){localStorage&&localStorage.getItem("TWPGanttSplitPos")&&(h.perc=parseFloat(localStorage.getItem("TWPGanttSplitPos")))}();var u=$("<div>").addClass("toLeft").html("{").click(function(){h.resize(.001,300)});l.append(u);var c=$("<div>").addClass("toCenter").html("&#xa9;").click(function(){h.resize(50,300)});l.append(c);var f=$("<div>").addClass("toRight").html("}").click(function(){h.resize(99.9999,300)});l.append(f),o.append(e),d.append(n),i.append(o).append(d).append(l),t.append(i);var p=t.innerWidth(),g=l.width(),m=p*r/100-g;m=m>p-g-h.secondBoxMinWidth?p-g-h.secondBoxMinWidth:m,o.width(m).css({left:0}),l.css({left:o.width()}),d.width(p-m-g).css({left:o.width()+g}),l.on("mousedown.gdf",function(t){t.preventDefault(),$("body").addClass("gdfHResizing"),$.splittify.splitterBar=$(this),$("body").unselectable().on("mousemove.gdf",function(t){t.preventDefault();var e=$.splittify.splitterBar,n=t.pageX-e.parent().offset().left,r=e.parent().width();n=n>h.firstBoxMinWidth?n:h.firstBoxMinWidth,n=n>p-g-h.secondBoxMinWidth?p-g-h.secondBoxMinWidth:n,e.css({left:n}),o.width(n),d.css({left:n+e.width(),width:r-n-e.width()}),h.perc=o.width()/h.element.width()*100}).on("mouseup.gdf",function(){$(this).off("mousemove.gdf").off("mouseup.gdf").clearUnselectable(),delete $.splittify.splitterBar,$("body").removeClass("gdfHResizing"),s()})});var v=!1;return o.add(d).scroll(function(e){var n=$(this),r=n.scrollTop();n.is(".splitBox1")&&"splitBox2"!=v?(v="splitBox1",d.scrollTop(r)):n.is(".splitBox2")&&"splitBox1"!=v&&(v="splitBox2",o.scrollTop(r)),o.find(".ganttFixHead").css("top",r),d.find(".ganttFixHead").css("top",r),t.stopTime("reset").oneTime(100,"reset",function(){v=""})}),o.on("mousewheel MozMousePixelScroll",function(t){t.preventDefault();var e=t.originalEvent.wheelDeltaY,n=t.originalEvent.wheelDeltaX;t.originalEvent.axis&&(e=2==t.originalEvent.axis?-t.originalEvent.detail:null,n=1==t.originalEvent.axis?-t.originalEvent.detail:null),e=Math.abs(e)<40?Math.abs(e)/e*40:e,n=Math.abs(n)<40?Math.abs(n)/n*40:n;var r=d.scrollTop()-e,a=o.scrollLeft()-n;return e&&d.scrollTop(r),n&&o.scrollLeft(a),!1}),h}},Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var n=new Array,r=arguments[1],a=0;a<e;a++)if(a in this){var s=this[a];t.call(r,s,a,this)&&n.push(s)}return n}),Task.prototype.clone=function(){var t={};for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t},Task.prototype.getAssigsString=function(){for(var t="",e=0;e<this.assigs.length;e++){var n=this.assigs[e],r=this.master.getResource(n.resourceId);r&&(t=t+(""==t?"":", ")+r.name)}return t},Task.prototype.createAssignment=function(t,e,n,r){var a=new Assignment(t,e,n,r);return this.assigs.push(a),a},Task.prototype.setPeriod=function(t,e){t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime());var n={start:this.start,end:this.end,duration:this.duration};t=computeStart(t),e=computeEnd(e);var r=recomputeDuration(t,e);if(t==n.start&&e==n.end&&r==n.duration)return!0;if(r==this.duration)return this.moveTo(t,!1);var a=t;t>e&&(t=e);var s=this.computeStartBySuperiors(t);if(s!=t)return this.moveTo(s,!1);var i=!1;this.start==t&&this.start==a||(this.start=t,i=!0);var o=e;if(this.end==e&&this.end==o||(this.end=e,i=!0),this.duration=recomputeDuration(this.start,this.end),!i)return!0;if(!this.canWrite)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.CANNOT_WRITE,this),!1;if(this.hasExternalDep)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS,this),!1;var l=!0,d=n.duration-this.duration,h=d>0,u=(h&&this.start,h&&n.end>this.end);if(h){for(var c=this.getChildren(),f=1/0,p=0,g=0;g<c.length;g++){var m=c[g];u?p=Math.max(p,m.end):f=Math.min(f,m.start)}u?this.end=Math.max(p,this.end):this.start=Math.min(f,this.start),this.duration=recomputeDuration(this.start,this.end)}else(this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate)&&(this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this),l=!1),l&&!updateTree(this)&&(l=!1);return l&&(l=this.propagateToInferiors(e)),l},Task.prototype.moveTo=function(t,e){t instanceof Date&&(t=t.getTime());var n={start:this.start,end:this.end},r=t;if(t=computeStart(t),!e&&this.startIsMilestone&&t!=this.start)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.START_IS_MILESTONE,this),!1;if(this.hasExternalDep)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS,this),!1;t=this.computeStartBySuperiors(t);var a=computeEndByDuration(t,this.duration);if(this.start!=t||this.start!=r){if(!e&&this.endIsMilestone&&a!=this.end)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.END_IS_MILESTONE,this),!1;if(this.start=t,this.end=a,this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate)return this.master.setErrorOnTransaction('"'+this.name+'"\n'+GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this),!1;for(var s=new Date(n.start).distanceInWorkingDays(new Date(this.start)),i=this.getChildren(),o=0;o<i.length;o++){ch=i[o];var l=new Date(ch.start).incrementDateByWorkingDays(s);if(!ch.moveTo(l,!1))return!1}return!!updateTree(this)&&this.propagateToInferiors(a)}return!0},Task.prototype.propagateToInferiors=function(t){var e=!0,n=this.getInferiors();if(n&&n.length>0)for(var r=0;r<n.length;r++){var a=n[r];if(!a.to.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+'\n"'+a.to.name+'"',a.to);break}if(!(e=a.to.moveTo(t,!1)))break}return e},Task.prototype.computeStartBySuperiors=function(t){var e=t,n=this.getSuperiors();if(n&&n.length>0){e=0;for(var r=0;r<n.length;r++){var a=n[r];e=Math.max(e,incrementDateByWorkingDays(a.from.end,a.lag))}e+=1}return computeStart(e)},Task.prototype.changeStatus=function(t,e){function n(t,n,i,o,l){var d=t.status;if(n==d&&!e)return!0;var h=!0;if(t.status=n,"STATUS_DONE"==n){if(t.master.permissions.cannotCloseTaskIfIssueOpen&&t.openIssues>0)return t.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_CLOSE_TASK_IF_OPEN_ISSUE+' "'+t.name+'"'),!1;if(i||"STATUS_FAILED"!=d){for(var u=t.getSuperiors(),c=0;c<u.length;c++)if("STATUS_DONE"!=u[c].from.status&&s.indexOf(u[c].from)<0){(i||o)&&t.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+'\n"'+u[c].from.name+'" -> "'+t.name+'"'),h=!1;break}h&&(t.master.set100OnClose&&!t.progressByWorklog&&(t.progress=100),a(t,n,!1),r(t.getInferiors(),"STATUS_ACTIVE"))}else h=!1}else if("STATUS_ACTIVE"==n)if(i||"STATUS_FAILED"!=d){for(var u=t.getSuperiors(),c=0;c<u.length;c++)if("STATUS_DONE"!=u[c].from.status){(i||l)&&t.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+'\n"'+u[c].from.name+'" -> "'+t.name+'"'),h=!1;break}if(h){var f=t.getParent();f&&"STATUS_ACTIVE"!=f.status&&(h=!1)}h&&("STATUS_UNDEFINED"!=d&&"STATUS_SUSPENDED"!=d||a(t,n,!0),r(t.getInferiors(),"STATUS_SUSPENDED"))}else h=!1;else if("STATUS_SUSPENDED"==n)if(i||"STATUS_FAILED"!=d){var f=t.getParent();f&&"STATUS_ACTIVE"!=f.status&&"STATUS_SUSPENDED"!=f.status&&(h=!1),h&&(a(t,n,!0),r(t.getInferiors(),n))}else h=!1;else"STATUS_FAILED"!=n&&"STATUS_UNDEFINED"!=n||(a(t,n,!1),r(t.getInferiors(),n));return h||(t.status=d),h}function r(t,e){for(var r=0;r<t.length;r++)n(t[r].to,e,!1,!1,!1)}function a(t,e,r){for(var a=t.getChildren(),s=0;s<a.length;s++)r&&"STATUS_DONE"==a[s].status||n(a[s],e,!1,!0,!1)}var s=this.getDescendant(),i=this.status;return!!n(this,t,!0,!1,!1)||(this.status=i,!1)},Task.prototype.synchronizeStatus=function(){var t=this.status;return this.status=this.getParent()?this.getParent().status:"STATUS_UNDEFINED",this.changeStatus(t,!0)},Task.prototype.isLocallyBlockedByDependencies=function(){for(var t=this.getSuperiors(),e=!1,n=0;n<t.length;n++)if("STATUS_DONE"!=t[n].from.status){e=!0;break}return e},Task.prototype.getRow=function(){return ret=-1,this.master&&(ret=this.master.tasks.indexOf(this)),ret},Task.prototype.getParents=function(){var t;if(this.master){var e=this.level,n=this.getRow();t=[];for(var r=n;r>=0;r--){var a=this.master.tasks[r];e>a.level&&(e=a.level,t.push(a))}}return t},Task.prototype.getParent=function(){var t;if(this.master)for(var e=this.getRow();e>=0;e--){var n=this.master.tasks[e];if(this.level>n.level){t=n;break}}return t},Task.prototype.isParent=function(){var t=!1;if(this.master){var e=this.getRow();e<this.master.tasks.length-1&&(t=this.master.tasks[e+1].level>this.level)}return t},Task.prototype.getChildren=function(){var t=[];if(this.master)for(var e=this.getRow(),n=e+1;n<this.master.tasks.length;n++){var r=this.master.tasks[n];if(r.level==this.level+1)t.push(r);else if(r.level<=this.level)break}return t},Task.prototype.getDescendant=function(){var t=[];if(this.master)for(var e=this.getRow(),n=e+1;n<this.master.tasks.length;n++){var r=this.master.tasks[n];if(!(r.level>this.level))break;t.push(r)}return t},Task.prototype.getSuperiors=function(){var t=[],e=this;return this.master&&(t=this.master.links.filter(function(t){return t.to==e})),t},Task.prototype.getSuperiorTasks=function(){for(var t=[],e=this.getSuperiors(),n=0;n<e.length;n++)t.push(e[n].from);return t},Task.prototype.getInferiors=function(){var t=[],e=this;return this.master&&(t=this.master.links.filter(function(t){return t.from==e})),t},Task.prototype.getInferiorTasks=function(){for(var t=[],e=this.getInferiors(),n=0;n<e.length;n++)t.push(e[n].to);return t},Task.prototype.deleteTask=function(){this.master.currentTask&&this.master.currentTask.id==this.id&&delete this.master.currentTask,this.rowElement&&this.rowElement.remove(),this.ganttElement&&this.ganttElement.remove();for(var t=this.getChildren(),e=0;e<t.length;e++)t[e].deleteTask();this.isNew()||this.master.deletedTaskIds.push(this.id),this.master.tasks.splice(this.getRow(),1);var n=this;this.master.links=this.master.links.filter(function(t){return t.from!=n&&t.to!=n})},Task.prototype.isNew=function(){return 0==(this.id+"").indexOf("tmp_")},Task.prototype.isDependent=function(t){for(var e=this,n=this.master.links.filter(function(t){return t.from==e}),r=0;r<n.length;r++)if(n[r].to==t)return!0;for(var r=0;r<n.length;r++)if(n[r].to.isDependent(t))return!0;return!1},Task.prototype.setLatest=function(t){this.latestStart=t-this.criticalCost,this.latestFinish=this.latestStart+this.duration},Task.prototype.indent=function(){var t=this.getRow();if(t<=0)return!1;var e=!1,n=this.master.tasks[t-1];if(this.level+1<=n.level+1){e=!0,this.level++;var r=this.getParents();this.level--;for(var a=this.level,s=t;s<this.master.tasks.length;s++){var i=this.master.tasks[s];if(!(i.level>a||i==this))break;i.level++,this.master.links=this.master.links.filter(function(t){var e=!1;return t.to==i?e=r.indexOf(t.from)>=0:t.from==i&&(e=r.indexOf(t.to)>=0),!e});for(var o=[],l=0;l<r.length;l++)o=o.concat(r[l].getSuperiorTasks());this.master.links=this.master.links.filter(function(t){var e=!1;return t.from==i&&(e=o.indexOf(t.to)>=0),!e})}var d=this.getParent();if(d&&!this.depends){var h=computeEndByDuration(d.start,this.duration);this.master.changeTaskDates(this,d.start,h)}this.master.updateDependsStrings(),updateTree(this),this.getParent().synchronizeStatus()}return e},Task.prototype.outdent=function(){if(this.level<=1)return!1;var t=!1,e=this.level;t=!0;for(var n=this.getRow(),r=n;r<this.master.tasks.length;r++){var a=this.master.tasks[r];if(!(a.level>e||a==this))break;a.level--}var s=this,i=this.getChildren();this.master.links=this.master.links.filter(function(t){return!(t.to==s&&i.indexOf(t.from)>=0||t.from==s&&i.indexOf(t.to)>=0)});for(var r=0;r<i.length;r++)i[r].setPeriod(i[r].start+1,i[r].end+1);return this.master.updateDependsStrings(),this.setPeriod(this.start+1,this.end+1),this.synchronizeStatus(),t},Task.prototype.moveUp=function(){var t=!1,e=this.getRow();if(e<=0)return!1;var n;for(n=e-1;n>=0&&!(this.master.tasks[n].level<=this.level);n--);if(this.master.tasks[n].level==this.level){t=!0;for(var r=0,a=e+1;a<this.master.tasks.length;a++){if(!(this.master.tasks[a].level>this.level))break;r++}var s=this.master.tasks.splice(e,r+1),i=this.master.tasks.splice(0,n);this.master.tasks=[].concat(i,s,this.master.tasks);var o=this.master.editor.element.find("tr[taskid]"),l=o.slice(e,e+r+1);o.eq(n).before(l),this.master.updateDependsStrings()}else this.master.setErrorOnTransaction(GanttMaster.messages.TASK_MOVE_INCONSISTENT_LEVEL,this),t=!1;return t},Task.prototype.moveDown=function(){var t=this.getRow();if(t>=this.master.tasks.length-1||0==t)return!1;var e,n=!1;for(e=t+1;e<this.master.tasks.length&&!(this.master.tasks[e].level<=this.level);e++);if(this.master.tasks[e]&&this.master.tasks[e].level==this.level){for(n=!0,e+=1;e<this.master.tasks.length&&!(this.master.tasks[e].level<=this.level);e++);for(var r=0,a=t+1;a<this.master.tasks.length;a++){if(!(this.master.tasks[a].level>this.level))break;r++}var s=this.master.tasks.splice(t,r+1),i=this.master.tasks.splice(0,e-r-1);this.master.tasks=[].concat(i,s,this.master.tasks);var o=this.master.editor.element.find("tr[taskid]"),l=o.eq(e-1),d=o.slice(t,t+r+1);l.after(d),this.master.updateDependsStrings()}return n},Ganttalendar.prototype.zoomGantt=function(t){var e=this.zoom,n=this.zoomLevels.indexOf(e+""),r=this.getCenterMillis(),a=n;(a=t?n<=0?0:n-1:n>=this.zoomLevels.length-1?this.zoomLevels.length-1:n+1)!=n&&(e=this.zoomLevels[a],this.zoom=e,this.refreshGantt(),this.goToMillis(r))},Ganttalendar.prototype.create=function(t,e,n){function r(t,e,n,r){var a=$("<th>").html(t).attr("colSpan",e);return r&&a.width(r),n&&a.addClass(n),a}function a(t,e,n){var r=$("<td>").html("").attr("colSpan",t).addClass("ganttBodyCell");return e&&r.addClass("end"),n&&r.addClass(n),r}var s=this;if(this.includeToday){var i=(new Date).getTime();e=e>i?i:e,n=n<i?i:n}var o=function(t,e,n){var r=new Date(e),a=new Date(n);return r.setHours(0,0,0,0),a.setHours(23,59,59,999),"d"==t?(r.setFirstDayOfThisWeek(),a.setFirstDayOfThisWeek(),a.setDate(a.getDate()+6)):"w"==t?(r.setFirstDayOfThisWeek(),r.setDate(r.getDate()-7),a.setFirstDayOfThisWeek(),a.setDate(a.getDate()+13)):"w2"==t?(r.setFirstDayOfThisWeek(),r.setDate(r.getDate()-7),a.setFirstDayOfThisWeek(),a.setDate(a.getDate()+20)):"w3"==t?(r.setFirstDayOfThisWeek(),r.setDate(r.getDate()-7),a.setFirstDayOfThisWeek(),a.setDate(a.getDate()+27)):"m"==t?(r.setDate(1),r.setMonth(r.getMonth()-1),a.setDate(1),a.setMonth(a.getMonth()+2),a.setDate(a.getDate()-1)):"m2"==t?(r.setDate(1),r.setMonth(r.getMonth()-1),a.setDate(1),a.setMonth(a.getMonth()+3),a.setDate(a.getDate()-1)):"q"==t?(r.setDate(r.getDate()-r.getDay()+1),r.setDate(r.getDate()-7),a.setFirstDayOfThisWeek(),a.setDate(a.getDate()+13)):"q2"==t?(r.setDate(1),r.setMonth(3*Math.floor(r.getMonth()/3)),r.setMonth(r.getMonth()-3),a.setDate(1),a.setMonth(3*Math.floor(a.getMonth()/3)+6),a.setDate(a.getDate()-1)):"s"==t?(r.setDate(1),r.setMonth(6*Math.floor(r.getMonth()/6)),r.setMonth(r.getMonth()-6),a.setDate(1),a.setMonth(6*Math.floor(a.getMonth()/6)+12),a.setDate(a.getDate()-1)):"y"==t&&(r.setDate(1),r.setMonth(0),r.setFullYear(r.getFullYear()-1),a.setDate(1),a.setMonth(24),a.setDate(a.getDate()-1)),{start:r.getTime(),end:a.getTime()}}(t,e,n);return s.startMillis=o.start,s.endMillis=o.end,s.originalStartMillis=e,s.originalEndMillis=n,function(t,e,n){function i(t,r){for(var a=new Date(e);a.getTime()<=n;)t(a);for(a=new Date(e);a.getTime()<=n;)r(a)}var o,l,d=$("<tr>").addClass("ganttHead1"),h=$("<tr>").addClass("ganttHead2"),u=$("<tr>").addClass("ganttBody");"y"==t?(l=100/15552e6,i(function(t){d.append(r(t.format("yyyy"),2)),t.setFullYear(t.getFullYear()+1)},function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+6);var n=(e.getTime()-t.getTime())*l,s=Math.floor(t.getMonth()/6)+1;h.append(r(GanttMaster.messages.GANTT_SEMESTER_SHORT+s,1,null,n)),u.append(a(1,2==s)),t.setMonth(t.getMonth()+6)})):"s"==t?(l=200/7776e6,i(function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+6),e.setDate(e.getDate()-1),d.append(r(t.format("MMMM")+" - "+e.format("MMMM yyyy"),6)),t.setMonth(t.getMonth()+6)},function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("MMM"),1,null,n)),u.append(a(1,(t.getMonth()+1)%6==0)),t.setMonth(t.getMonth()+1)})):"q2"==t?(l=150/2592e6,i(function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+3),e.setDate(e.getDate()-1),d.append(r(t.format("MMMM")+" - "+e.format("MMMM yyyy"),3)),t.setMonth(t.getMonth()+3)},function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+1);var n=(e.getTime()-t.getTime())*l,s=t.format("MMMM");h.append(r(s,1,null,n)),u.append(a(1,t.getMonth()%3==2)),t.setMonth(t.getMonth()+1)})):"q"==t?(l=300/2592e6,i(function(t){var e=new Date(t.getTime());e.setMonth(e.getMonth()+3),e.setDate(e.getDate()-1),d.append(r(t.format("MMMM")+" - "+e.format("MMMM yyyy"),Math.round((e.getTime()-t.getTime())/864e5))),t.setMonth(t.getMonth()+3)},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+7);var n=(e.getTime()-t.getTime())*l,s="<small>"+i18n.WEEK_SHORT.toLowerCase()+"</small> "+t.format("w");h.append(r(s,7,null,n)),u.append(a(7,!1)),t.setDate(t.getDate()+7)})):"m2"==t?(l=15/864e5,i(function(t){var e=t.getTime();t.setMonth(t.getMonth()+1);var n=Math.round((t.getTime()-e)/864e5);d.append(r(new Date(e).format("MMMM yyyy"),n))},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("d"),1,isHoliday(t)?"holyH headSmall":"headSmall",n));var s=new Date(t.getTime());s.setDate(t.getDate()+1),u.append(a(1,1==s.getDate(),isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):"m"==t?(l=25/864e5,i(function(t){var e=t.getTime();t.setMonth(t.getMonth()+1);var n=Math.round((t.getTime()-e)/864e5);d.append(r(new Date(e).format("MMMM yyyy"),n))},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("d"),1,isHoliday(t)?"holyH":null,n));var s=new Date(t.getTime());s.setDate(t.getDate()+1),u.append(a(1,1==s.getDate(),isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):"w3"==t?(l=30/864e5,i(function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+6),d.append(r(t.format("MMM d")+" - "+e.format("MMM d 'yy"),7)),t.setDate(t.getDate()+7)},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("EEEE").substr(0,1),1,isHoliday(t)?"holyH":null,n)),u.append(a(1,t.getDay()%7==(s.master.firstDayOfWeek+6)%7,isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):"w2"==t?(l=40/864e5,i(function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+6),d.append(r(t.format("MMM d")+" - "+e.format("MMM d 'yy"),7)),t.setDate(t.getDate()+7)},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("EEEE").substr(0,1),1,isHoliday(t)?"holyH":null,n)),u.append(a(1,t.getDay()%7==(s.master.firstDayOfWeek+6)%7,isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):"w"==t?(l=50/864e5,i(function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+6),d.append(r(t.format("MMM d")+" - "+e.format("MMM d 'yy"),7)),t.setDate(t.getDate()+7)},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("EEEE").substr(0,1),1,isHoliday(t)?"holyH":null,n)),u.append(a(1,t.getDay()%7==(s.master.firstDayOfWeek+6)%7,isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):"d"==t?(l=100/864e5,i(function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+6),d.append(r(t.format("MMMM d")+" - "+e.format("MMMM d yyyy"),7)),t.setDate(t.getDate()+7)},function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+1);var n=(e.getTime()-t.getTime())*l;h.append(r(t.format("EEE d"),1,isHoliday(t)?"holyH":null,n)),u.append(a(1,t.getDay()%7==(s.master.firstDayOfWeek+6)%7,isHoliday(t)?"holy":null)),t.setDate(t.getDate()+1)})):console.error("Wrong level "+t),o=(n-e)*l,o=Math.max(o,s.minGanttSize);var c=$("<table cellspacing=0 cellpadding=0>");c.append(d).append(h);var f=c.clone().addClass("ganttFixHead");c.append(u).addClass("ganttTable");var p=s.master.editor.element.height();c.height(p);var g=$("<div>");return g.addClass("gantt unselectable").attr("unselectable","true").css({position:"relative",width:o}),g.append(c),g.append(f),g.svg({settings:{class:"ganttSVGBox"},onLoad:function(t){var e=t.defs("myDefs"),n=t.pattern(e,"extDep",0,0,10,10,0,0,10,10,{patternUnits:"userSpaceOnUse"});t.image(n,0,0,10,10,s.master.resourceUrl+"hasExternalDeps.png",{opacity:.3});s.svg=t,$(t).addClass("ganttSVGBox");for(var r=t.group("gridGroup"),a=40;a<=p;a+=s.rowHeight)t.rect(r,0,a,"100%",s.rowHeight,{class:"ganttLinesSVG"});if(s.linksGroup=t.group("linksGroup"),s.tasksGroup=t.group("tasksGroup"),s.fx=l,(new Date).getTime()>s.startMillis&&(new Date).getTime()<s.endMillis){var i=Math.round(((new Date).getTime()-s.startMillis)*s.fx);t.line(r,i,0,i,"100%",{class:"ganttTodaySVG"})}}}),g}(t,o.start,o.end)},Ganttalendar.prototype.drawTask=function(t){var e=this;editorRow=t.rowElement;var n=editorRow.position().top+editorRow.offsetParent().scrollTop(),r=Math.round((t.start-e.startMillis)*e.fx);t.hasChild=t.isParent();var a=$(function(t,n){var r=e.svg,a=r.svg(e.tasksGroup,n.x,n.y,n.width,n.height,{class:"taskBox taskBoxSVG taskStatusSVG",status:t.status,taskid:t.id});r.rect(a,0,0,"100%","100%",{class:"taskLayout",rx:"2",ry:"2"});if(t.hasExternalDep&&r.rect(a,0,0,"100%","100%",{fill:"url(#extDep)"}),t.progress>0){r.rect(a,0,"20%",(t.progress>100?100:t.progress)+"%","60%",{rx:"2",ry:"2",fill:"rgba(0,0,0,.4)"});if(n.width>50){var s={fill:"#888","font-size":"10px",class:"textPerc teamworkIcons",transform:"translate(5)"};t.progress>100&&(s["font-weight"]="bold"),t.progress>90&&(s.transform="translate(-40)"),r.text(a,(t.progress>90?100:t.progress)+"%",(e.rowHeight-5)/2,(t.progress>100?"!!! ":"")+t.progress+"%",s)}}return t.hasChild&&r.rect(a,0,0,"100%",3,{fill:"#000"}),t.startIsMilestone&&r.image(a,-9,n.height/2-9,18,18,e.master.resourceUrl+"milestone.png"),t.endIsMilestone&&r.image(a,"100%",n.height/2-9,18,18,e.master.resourceUrl+"milestone.png",{transform:"translate(-9)"}),r.text(a,"100%",18,t.name,{class:"taskLabelSVG",transform:"translate(20,-5)"}),t.level>0&&(r.circle(a,"0",n.height/2,n.height/3,{class:"taskLinkStartSVG linkHandleSVG",transform:"translate("+(-n.height/3+1)+")"}),r.circle(a,"100%",n.height/2,n.height/3,{class:"taskLinkEndSVG linkHandleSVG",transform:"translate("+(n.height/3-1)+")"})),a}(t,{x:r,y:n+e.taskVertOffset,width:Math.round((t.end-t.start)*e.fx),height:e.taskHeight}));t.ganttElement=a,e.showCriticalPath&&t.isCritical&&a.addClass("critical"),this.master.permissions.canWrite&&t.canWrite&&(a.click(function(t){t.stopPropagation(),e.element.find("[class*=focused]").removeClass("focused"),$(".ganttSVGBox .focused").removeClass("focused");var n=$(this);e.resDrop||n.addClass("focused"),e.resDrop=!1,$("body").off("click.focused").one("click.focused",function(){$(".ganttSVGBox .focused").removeClass("focused")})}).dblclick(function(){e.master.showTaskEditor($(this).attr("taskid"))}).mouseenter(function(){var t=$(this);e.linkOnProgress?t.addClass("linkOver"):t.find("[class*=linkHandleSVG]").show()}).mouseleave(function(){$(this).removeClass("linkOver").find("[class*=linkHandleSVG]").hide()}).mouseup(function(t){$(":focus").blur()}).mousedown(function(){e.master.getTask($(this).attr("taskid")).rowElement.click()}).dragExtedSVG($(e.svg.root()),{canResize:this.master.permissions.canWrite&&t.canWrite,canDrag:!t.depends&&this.master.permissions.canWrite&&t.canWrite,startDrag:function(t){$(".ganttSVGBox .focused").removeClass("focused")},drag:function(e){$("[from="+t.id+"],[to="+t.id+"]").trigger("update")},drop:function(t){e.resDrop=!0;var n=$(this),r=e.master.getTask(n.attr("taskid")),a=Math.round(parseFloat(n.attr("x"))/e.fx+e.startMillis);e.master.beginTransaction(),e.master.moveTask(r,new Date(a)),e.master.endTransaction()},startResize:function(t){$(".ganttSVGBox .focused").removeClass("focused");var n=$(this),r=$(e.svg.text(parseInt(n.attr("x"))+parseInt(n.attr("width")+8),parseInt(n.attr("y")),"",{"font-size":"10px",fill:"red"}));a.data("textDur",r)},resize:function(n){var r=$(this),s=Math.round(parseFloat(r.attr("x"))/e.fx+e.startMillis),i=Math.round((parseFloat(r.attr("x"))+parseFloat(r.attr("width")))/e.fx+e.startMillis),o=computeStartDate(s).distanceInWorkingDays(computeEndDate(i))+1;a.data("textDur").attr("x",parseInt(r.attr("x"))+parseInt(r.attr("width"))+8).html(o),$("[from="+t.id+"],[to="+t.id+"]").trigger("update")},stopResize:function(t){e.resDrop=!0;var n=a.data("textDur");n&&n.remove();var r=$(this),s=e.master.getTask(r.attr("taskid")),i=Math.round(parseFloat(r.attr("x"))/e.fx+e.startMillis),o=Math.round((parseFloat(r.attr("x"))+parseFloat(r.attr("width")))/e.fx+e.startMillis);e.master.beginTransaction(),e.master.changeTaskDates(s,new Date(i),new Date(o)),e.master.endTransaction()}}),a.find("[class*=linkHandleSVG]").mousedown(function(t){t.preventDefault(),t.stopPropagation();var n=$(this).closest(".taskBoxSVG"),r=$(e.svg.root()),a=r.offset();e.linkOnProgress=!0,e.linkFromEnd=$(this).is(".taskLinkEndSVG"),r.addClass("linkOnProgress");var s=parseFloat(n.attr("x"))+(e.linkFromEnd?parseFloat(n.attr("width")):0),i=parseFloat(n.attr("y"))+parseFloat(n.attr("height"))/2,o=e.svg.line(s,i,t.pageX-a.left-5,t.pageY-a.top-5,{class:"linkLineSVG"}),l=e.svg.circle(s,i,5,{class:"linkLineSVG"});r.bind("mousemove.linkSVG",function(t){var n=r.offset(),a=t.pageX-n.left,d=t.pageY-n.top,h=Math.sqrt(Math.pow(a-s,2)+Math.pow(d-i,2));a-=10*(a-s)/h,d-=10*(d-i)/h,e.svg.change(o,{x2:a,y2:d}),e.svg.change(l,{cx:a,cy:d})}),$("body").one("mouseup.linkSVG",function(t){$(o).remove(),$(l).remove(),e.linkOnProgress=!1,r.removeClass("linkOnProgress"),$(e.svg.root()).unbind("mousemove.linkSVG");var a=$(t.target).closest(".taskBoxSVG");if(a&&a.attr("taskid")!=n.attr("taskid")){var s,i;if(e.linkFromEnd?(s=e.master.getTask(a.attr("taskid")),i=e.master.getTask(n.attr("taskid"))):(i=e.master.getTask(a.attr("taskid")),s=e.master.getTask(n.attr("taskid"))),s&&i){var d=s.rowElement.find("[name=depends]");d.val(d.val()+((d.val()+"").length>0?",":"")+(i.getRow()+1)),d.blur()}}})})),e.redrawLinks()},Ganttalendar.prototype.addTask=function(t){this.originalEndMillis=this.originalEndMillis>t.end?this.originalEndMillis:t.end,this.originalStartMillis=this.originalStartMillis<t.start?this.originalStartMillis:t.start},Ganttalendar.prototype.drawLink=function(t,e,n){function r(t){t.ganttElement.position();return{left:parseFloat(t.ganttElement.attr("x")),top:parseFloat(t.ganttElement.attr("y")),width:parseFloat(t.ganttElement.attr("width")),height:parseFloat(t.ganttElement.attr("height"))}}var a,s=this;a="start-to-start"==n?function(t,e){console.error("StartToStart not supported on SVG");r(t),r(e)}(t,e):function(t,e,n){function a(){var t=$(this),e=t.data("from"),a=t.data("to"),s=r(e),o=r(a),l=(s.left,s.left+s.width),d=s.height/2+s.top,h=o.left,u=(o.left,o.width,o.height/2+o.top),c=h<l+2*n,f=d>u,p=f?-1:1,g=l+2*n>h,m=g?-1:1,v=t.find("image"),y=i.createPath();if(c){var T=p*(s.height/2-10+2);y.move(l,d).line(n,0,!0).arc(5,5,90,!1,!f,5,5*p,!0).line(0,T,!0).arc(5,5,90,!1,!f,-5,5*p,!0).line(2*m*n+(h-l),0,!0).arc(5,5,90,!1,f,-5,5*p,!0).line(0,(Math.abs(u-d)-20-Math.abs(T))*p-5,!0).arc(5,5,90,!1,f,5,5*p,!0).line(n,0,!0),v.attr({x:h-5,y:u-5-5})}else y.move(l,d).line((h-l)/2-5,0,!0).arc(5,5,90,!1,!f,5,5*p,!0).line(0,u-d-2*p*5+5,!0).arc(5,5,90,!1,f,5,5*p,!0).line((h-l)/2-5,0,!0),v.attr({x:h-5,y:u-5+5});t.find("path").attr({d:y.path()})}var i=s.svg,o=i.group(s.linksGroup,t.id+"-"+e.id);i.title(o,t.name+" -> "+e.name);var l=i.createPath();i.image(o,0,0,5,10,s.master.resourceUrl+"linkArrow.png"),i.path(o,l,{class:"taskLinkPathSVG"});var d=$(o).data({from:t,to:e}).attr({from:t.id,to:e.id}).on("update",a).trigger("update");return s.showCriticalPath&&t.isCritical&&e.isCritical&&d.addClass("critical"),d.addClass("linkGroup"),d}(t,e,10),this.master.permissions.canWrite&&(t.canWrite||e.canWrite)&&a.click(function(t){var e=$(this);t.stopPropagation(),s.element.find("[class*=focused]").removeClass("focused"),$(".ganttSVGBox .focused").removeClass("focused");var e=$(this);s.resDrop||e.addClass("focused"),s.resDrop=!1,$("body").off("click.focused").one("click.focused",function(){$(".ganttSVGBox .focused").removeClass("focused")})})},Ganttalendar.prototype.redrawLinks=function(){var t=this;this.element.stopTime("ganttlnksredr"),this.element.oneTime(60,"ganttlnksredr",function(){$("#linksSVG").empty();for(var e=[],e=t.master.getCollapsedDescendant(),n=0;n<t.master.links.length;n++){var r=t.master.links[n];e.indexOf(r.from)>=0||e.indexOf(r.to)>=0||t.drawLink(r.from,r.to)}})},Ganttalendar.prototype.reset=function(){this.element.find("[class*=linkGroup]").remove(),this.element.find("[taskid]").remove()},Ganttalendar.prototype.redrawTasks=function(){for(var t=this.master.getCollapsedDescendant(),e=0;e<this.master.tasks.length;e++){var n=this.master.tasks[e];t.indexOf(n)>=0||this.drawTask(n)}},Ganttalendar.prototype.refreshGantt=function(){this.showCriticalPath&&this.master.computeCriticalPath();var t=this.element.parent(),e=t.scrollTop(),n=t.scrollLeft();if(this.element.remove(),!this.zoom){var r=Math.round((this.originalEndMillis-this.originalStartMillis)/864e5);this.zoom=this.zoomLevels[r<2?0:r<15?1:r<30?2:r<45?3:r<60?4:r<90?5:r<180?6:r<600?7:8]}var a=this.create(this.zoom,this.originalStartMillis,this.originalEndMillis);this.element=a,t.append(a),this.redrawTasks(),t.scrollTop(e),t.scrollLeft(n),this.synchHighlight()},Ganttalendar.prototype.fitGantt=function(){delete this.zoom,this.refreshGantt()},Ganttalendar.prototype.synchHighlight=function(){if(this.master.currentTask){var t=this.master.editor.element.find(".taskEditRow:visible").index(this.master.currentTask.rowElement);this.master.gantt.element.find(".ganttLinesSVG").removeClass("rowSelected").eq(t).addClass("rowSelected")}else $(".rowSelected").removeClass("rowSelected")},Ganttalendar.prototype.getCenterMillis=function(){return parseInt((this.element.parent().scrollLeft()+this.element.parent().width()/2)/this.fx+this.startMillis)},Ganttalendar.prototype.goToMillis=function(t){var e=Math.round((t-this.startMillis)*this.fx)-this.element.parent().width()/2;this.element.parent().scrollLeft(e)},Ganttalendar.prototype.centerOnToday=function(){this.goToMillis((new Date).getTime())},$.fn.dragExtedSVG=function(t,e){function n(e){$(t).unbind("mousemove.deSVG").unbind("mouseup.deSVG").unbind("mouseleave.deSVG"),a&&a.attr("oldw")!=a.attr("width")&&o.stopResize.call(a.get(0),e),a=void 0,$("body").clearUnselectable()}function r(e){$(t).unbind("mousemove.deSVG").unbind("mouseup.deSVG").unbind("mouseleave.deSVG"),a&&a.attr("oldx")!=a.attr("x")&&o.drop.call(a.get(0),e),a=void 0,$("body").clearUnselectable()}var a,s,i,o={canDrag:!0,canResize:!0,resizeZoneWidth:10,minSize:10,startDrag:function(t){},drag:function(t){},drop:function(t){},startResize:function(t){},resize:function(t){},stopResize:function(t){}};return $.extend(o,e),this.each(function(){var e=$(this);s=t.parent().offset().left,o.canDrag&&e.addClass("deSVGdrag"),(o.canResize||o.canDrag)&&e.bind("mousedown.deSVG",function(s){$(s.target).is("image")&&s.preventDefault(),a=$(this);var l=parseFloat(e.find("[class*=taskLayout]").offset().left),d=l+parseFloat(e.attr("width")),h=s.pageX;if($("body").unselectable(),o.canResize&&d-l>3*o.resizeZoneWidth&&h<=d&&h>=d-o.resizeZoneWidth){i=d-s.pageX,a.attr("oldw",a.attr("width"));var u=!0;$(t).bind("mousemove.deSVG",function(t){u&&(o.startResize.call(a.get(0),t),u=!1);var e=t.pageX-l+i;a.attr("width",e<o.minSize?o.minSize:e),o.resize.call(a.get(0),t)}),$("body").one("mouseup.deSVG",n)}else if(o.canResize&&d-l>3*o.resizeZoneWidth&&h>=l&&h<=l+o.resizeZoneWidth){i=parseFloat(a.attr("x")),a.attr("oldw",a.attr("width"));var u=!0;$(t).bind("mousemove.deSVG",function(t){u&&(o.startResize.call(a.get(0),t),u=!1);var e=i-(h-t.pageX),n=d-l+(h-t.pageX);n=n<o.minSize?o.minSize:n,a.attr("x",e),a.attr("width",n),o.resize.call(a.get(0),t)}),$("body").one("mouseup.deSVG",n)}else if(o.canDrag){i=parseFloat(a.attr("x"))-s.pageX,a.attr("oldx",a.attr("x"));var u=!0;$(t).bind("mousemove.deSVG",function(t){u&&(o.startDrag.call(a.get(0),t),u=!1),a.attr("x",i+t.pageX),o.drag.call(a.get(0),t)}).bind("mouseleave.deSVG",r),$("body").one("mouseup.deSVG",r)}}).bind("mousemove.deSVG",function(t){var e=$(this),n=e.find("[class*=taskLayout]").offset().left,r=n+parseFloat(e.attr("width")),a=t.pageX;o.canResize&&r-n>3*o.resizeZoneWidth&&(a<=r&&a>=r-o.resizeZoneWidth||a>=n&&a<=n+o.resizeZoneWidth)?e.addClass("deSVGhand"):e.removeClass("deSVGhand")}).addClass("deSVG")}),this},GridEditor.prototype.fillEmptyLines=function(){var t=new TaskFactory,e=this.master,n=e.minRowsInEditor-this.element.find(".taskEditRow").length,r=this.element.find(".emptyRow").length;n=Math.max(n,r>5?0:5-r);for(var a=0;a<n;a++){var s=$.JST.createFromTemplate({},"TASKEMPTYROW");e.permissions.canSeeDep||s.find(".requireCanSeeDep").hide(),s.click(function(n){var r=$(this);if(e.permissions.canWrite&&e.permissions.canAdd&&!(r.prevAll(".emptyRow").length>0)){e.beginTransaction();var a,s=(new Date).getTime(),i=0;e.tasks[0]&&(s=e.tasks[0].start,i=e.tasks[0].level+1);var o=0;r.prevAll(".emptyRow").addBack().each(function(){o++;var n=t.build("tmp_fk"+(new Date).getTime()+"_"+o,"","",i,s,1);e.addTask(n);a=n}),e.endTransaction(),a.rowElement&&a.rowElement.find("[name=name]").focus()}}),this.element.append(s)}},GridEditor.prototype.addTask=function(t,e,n){this.element.find("[taskId="+t.id+"]").remove();var r=$.JST.createFromTemplate(t,"TASKROW");if(this.master.permissions.canSeeDep||r.find(".requireCanSeeDep").hide(),this.master.permissions.canSeePopEdit||r.find(".edit .teamworkIcon").hide(),t.rowElement=r,this.bindRowEvents(t,r),"number"!=typeof e){var a=this.element.find(".emptyRow:first");a.length>0?a.replaceWith(r):this.element.append(r)}else{var s=this.element.find("tr.taskEditRow").eq(e);s.length>0?s.before(r):this.element.append(r)}if(n){t.collapsed&&r.addClass("collapsed");this.master.getCollapsedDescendant().indexOf(t)>=0&&r.hide()}return r},GridEditor.prototype.refreshExpandStatus=function(t){if(t){t.isParent()?t.rowElement.addClass("isParent"):t.rowElement.removeClass("isParent");var e=t.getParent();e&&!e.rowElement.is("isParent")&&e.rowElement.addClass("isParent")}},GridEditor.prototype.refreshTaskRow=function(t){var e=t.rowElement;e.find(".taskRowIndex").html(t.getRow()+1),e.find(".indentCell").css("padding-left",10*t.level+18),e.find("[name=name]").val(t.name),e.find("[name=code]").val(t.code),e.find("[status]").attr("status",t.status),e.find("[name=duration]").val(t.duration),e.find("[name=progress]").val(t.progress).prop("readonly",1==t.progressByWorklog),e.find("[name=startIsMilestone]").prop("checked",t.startIsMilestone),e.find("[name=start]").val(new Date(t.start).format()).updateOldValue().prop("readonly",t.depends||!t.canWrite&&!this.master.permissions.canWrite),e.find("[name=endIsMilestone]").prop("checked",t.endIsMilestone),e.find("[name=end]").val(new Date(t.end).format()).updateOldValue(),e.find("[name=depends]").val(t.depends),e.find(".taskAssigs").html(t.getAssigsString()),t.collapsed?e.addClass("collapsed"):e.removeClass("collapsed"),this.master.element.trigger("gantt.task.afterupdate.event",t)},GridEditor.prototype.redraw=function(){for(var t=0;t<this.master.tasks.length;t++)this.refreshTaskRow(this.master.tasks[t]);this.master.fillWithEmptyLines&&this.fillEmptyLines()},GridEditor.prototype.reset=function(){this.element.find("[taskid]").remove()},GridEditor.prototype.bindRowEvents=function(t,e){var n=this;this.master.permissions.canWrite&&t.canWrite?n.bindRowInputEvents(t,e):(e.find("input").prop("readonly",!0),e.find("input:checkbox,select").prop("disabled",!0)),this.master.permissions.canSeeDep||e.find("[name=depends]").attr("readonly",!0),n.bindRowExpandEvents(t,e),this.master.permissions.canSeePopEdit&&(e.find(".edit").click(function(){n.openFullEditor(t,e,!1)}),e.find(".taskAssigs").dblclick(function(){n.openFullEditor(t,e,!0)}))},GridEditor.prototype.bindRowExpandEvents=function(t,e){var n=this;e.find(".exp-controller").click(function(){var t=$(this),e=t.closest("[taskid]").attr("taskid"),r=n.master.getTask(e);r.collapsed?n.master.expand(r,!1):n.master.collapse(r,!1)})},GridEditor.prototype.bindRowInputEvents=function(t,e){var n=this;e.find(".date").each(function(){var t=$(this);t.click(function(){$(this).dateField({inputField:t,callback:function(t){$(this).blur()}})}),t.blur(function(t){var e=$(this);if(e.isValueChanged())if(Date.isValid(e.val())){var r=e.closest("tr"),a=r.attr("taskId"),s=n.master.getTask(a),i=(e.prop("name"),resynchDates(e,r.find("[name=start]"),r.find("[name=startIsMilestone]"),r.find("[name=duration]"),r.find("[name=end]"),r.find("[name=endIsMilestone]")));n.master.beginTransaction(),n.master.changeTaskDates(s,i.start,i.end),n.master.endTransaction(),e.updateOldValue()}else alert(GanttMaster.messages.INVALID_DATE_FORMAT),e.val(e.getOldValue())})}),e.find(":checkbox").click(function(){var t=$(this),e=t.closest("tr"),r=e.attr("taskId"),a=n.master.getTask(r),s=t.prop("name");"startIsMilestone"!=s&&"endIsMilestone"!=s||(n.master.beginTransaction(),a[s]=t.prop("checked"),resynchDates(t,e.find("[name=start]"),e.find("[name=startIsMilestone]"),e.find("[name=duration]"),e.find("[name=end]"),e.find("[name=endIsMilestone]")),n.master.endTransaction())}),e.find("input:text:not(.date)").focus(function(){$(this).updateOldValue()}).blur(function(t){var e=$(this),r=e.closest("tr"),a=r.attr("taskId"),s=n.master.getTask(a),i=e.prop("name");if(e.isValueChanged()){if(n.master.beginTransaction(),"depends"==i){s.depends;s.depends=e.val();if(n.master.updateLinks(s)){for(var o=s.getSuperiors(),l=!1,d=!1,h=!1,u=!1,c=0;c<o.length;c++)l=l||"STATUS_FAILED"==o[c].from.status,d=d||"STATUS_UNDEFINED"==o[c].from.status,h=h||"STATUS_ACTIVE"==o[c].from.status,u=u||"STATUS_SUSPENDED"==o[c].from.status;l?s.changeStatus("STATUS_FAILED"):d?s.changeStatus("STATUS_UNDEFINED"):h?s.changeStatus("STATUS_SUSPENDED"):u?s.changeStatus("STATUS_SUSPENDED"):s.changeStatus("STATUS_ACTIVE"),n.master.changeTaskDeps(s)}}else if("duration"==i){var f=resynchDates(e,r.find("[name=start]"),r.find("[name=startIsMilestone]"),r.find("[name=duration]"),r.find("[name=end]"),r.find("[name=endIsMilestone]"));n.master.changeTaskDates(s,f.start,f.end)}else"name"==i&&""==e.val()?(s.deleteTask(),n.master.gantt.synchHighlight()):"progress"==i?(s[i]=parseFloat(e.val())||0,e.val(s[i])):s[i]=e.val();n.master.endTransaction()}else"name"==i&&""==e.val()&&(0!=s.getRow()?(s.deleteTask(),n.master.gantt.synchHighlight()):(e.oneTime(1,"foc",function(){$(this).focus()}),t.preventDefault()))}),e.find("input").keydown(function(t){var e=$(this),n=e.parent(),r=n.parent(),a=n.prevAll("td").length;if(!t.ctrlKey)switch(t.keyCode){case 37:e.is(":text")&&this.selectionEnd&&0!=this.selectionEnd||n.prev().find("input").focus();break;case 39:e.is(":text")&&this.selectionEnd&&this.selectionEnd!=this.value.length||n.next().find("input").focus();break;case 38:var s=r.prevAll(":visible:first"),i=s.find("td").eq(a),o=i.find("input");o.length>0&&o.focus();break;case 40:var l=r.nextAll(":visible:first"),i=l.find("td").eq(a),o=i.find("input");o.length>0?o.focus():l.click()}return!0}).focus(function(){$(this).closest("tr").click()}),e.find(".taskStatus").click(function(){var t=$(this),e=t.closest("[taskid]"),r=e.attr("taskid"),a=n.master.getTask(r),s=$.JST.createFromTemplate({},"CHANGE_STATUS");s.find("[status="+a.status+"]").addClass("selected"),s.find(".taskStatus").click(function(e){e.stopPropagation();var r=$(this).attr("status");s.remove(),n.master.beginTransaction(),a.changeStatus(r),n.master.endTransaction(),t.attr("status",a.status)}),t.oneTime(3e3,"hideChanger",function(){s.remove()}),t.after(s)}),e.click(function(t){var e=$(this);e.closest("table").find(".rowSelected").removeClass("rowSelected"),e.addClass("rowSelected"),n.master.currentTask=n.master.getTask(e.attr("taskId")),n.master.gantt.synchHighlight();var r=e.position().top;r>n.element.parent().height()?e.offsetParent().scrollTop(r-n.element.parent().height()+100):r<=40&&e.offsetParent().scrollTop(e.offsetParent().scrollTop()-40+r)})},GridEditor.prototype.openFullEditor=function(t,e,n){var r=this;if(r.master.permissions.canSeePopEdit){var a=e.attr("taskId"),s=$.JST.createFromTemplate(t,"TASK_EDITOR");n&&(s.find(".taskData").hide(),s.find(".assigsTableWrapper").height(455),s.prepend('<h1>"'+t.name+'"</h1>')),t.isNew()||!r.master.permissions.canSeeFullEdit?s.find("#taskFullEditor").remove():s.bind("openFullEditor.gantt",function(){window.location.href=contextPath+"/applications/teamwork/task/taskEditor.jsp?CM=ED&OBJID="+t.id}),s.find("#name").val(t.name),s.find("#description").val(t.description),s.find("#code").val(t.code),s.find("#progress").val(t.progress?parseFloat(t.progress):0).prop("readonly",1==t.progressByWorklog),s.find("#progressByWorklog").prop("checked",t.progressByWorklog),s.find("#status").val(t.status),s.find("#type").val(t.typeId),s.find("#type_txt").val(t.type),s.find("#relevance").val(t.relevance),t.startIsMilestone&&s.find("#startIsMilestone").prop("checked",!0),t.endIsMilestone&&s.find("#endIsMilestone").prop("checked",!0),s.find("#duration").val(t.duration);var i=s.find("#start");i.val(new Date(t.start).format()),t.depends||!this.master.permissions.canWrite&&!t.canWrite?i.attr("readonly","true"):i.removeAttr("readonly"),s.find("#end").val(new Date(t.end).format());var o=s.find("#assigsTable");o.find("[assId]").remove();for(var l=0;l<t.assigs.length;l++){var d=t.assigs[l],h=$.JST.createFromTemplate({task:t,assig:d},"ASSIGNMENT_ROW");o.append(h)}if(r.master.permissions.canWrite&&t.canWrite){s.find("#start,#end,#duration").click(function(){var t=$(this);t.is("[entrytype=DATE]")&&t.dateField({inputField:t,callback:function(t){$(this).blur()}})}).blur(function(){var t=$(this);t.validateField()&&(resynchDates(t,s.find("[name=start]"),s.find("[name=startIsMilestone]"),s.find("[name=duration]"),s.find("[name=end]"),s.find("[name=endIsMilestone]")),"function"==typeof workloadDatesChanged&&workloadDatesChanged())}),s.find("#startIsMilestone,#endIsMilestone").click(function(){resynchDates($(this),s.find("[name=start]"),s.find("[name=startIsMilestone]"),s.find("[name=duration]"),s.find("[name=end]"),s.find("[name=endIsMilestone]"))});var u=0;s.find("#addAssig").click(function(){u++;var e=s.find("#assigsTable"),n=$.JST.createFromTemplate({task:t,assig:{id:"tmp_"+(new Date).getTime()+"_"+u}},"ASSIGNMENT_ROW");e.append(n),$("#bwinPopupd").scrollTop(1e4)}).click(),s.bind("saveFullEditor.gantt",function(){var t=r.master.getTask(a);r.master.beginTransaction(),t.name=s.find("#name").val(),t.description=s.find("#description").val(),t.code=s.find("#code").val(),t.progress=parseFloat(s.find("#progress").val()),t.startIsMilestone=s.find("#startIsMilestone").is(":checked"),t.endIsMilestone=s.find("#endIsMilestone").is(":checked"),t.type=s.find("#type_txt").val(),t.typeId=s.find("#type").val(),t.relevance=s.find("#relevance").val(),t.progressByWorklog=s.find("#progressByWorklog").is(":checked");var e=0;s.find("tr[assId]").each(function(){var n=$(this),a=n.attr("assId"),s=n.find("[name=resourceId]").val(),i=n.find("[name=resourceId_txt]").val(),o=n.find("[name=roleId]").val(),l=millisFromString(n.find("[name=effort]").val(),!0),d=r.master.getOrCreateResource(s,i);if(d){for(var h=!1,u=0;u<t.assigs.length;u++){var c=t.assigs[u];if(a==c.id){c.effort=l,c.roleId=o,c.resourceId=d.id,c.touched=!0,h=!0;break}if(o==c.roleId&&d.id==c.resourceId){c.effort=l,c.touched=!0,h=!0;break}}if(!h&&s&&o){e++;var c=t.createAssignment("tmp_"+(new Date).getTime()+"_"+e,s,o,l);c.touched=!0}}}),t.assigs=t.assigs.filter(function(t){var e=t.touched;return delete t.touched,e}),t.setPeriod(Date.parseString(s.find("#start").val()).getTime(),Date.parseString(s.find("#end").val()).getTime()+792e5),t.changeStatus(s.find("#status").val()),r.master.endTransaction()&&(s.find(":input").updateOldValue(),closeBlackPopup())})}else s.find("input,textarea").prop("readOnly",!0),s.find("input:checkbox,select").prop("disabled",!0),s.find("#saveButton").remove(),s.find(".button").addClass("disabled");s.attr("alertonchange","true");createModalPopup(800,450).append(s);"function"==typeof workloadDatesChanged&&workloadDatesChanged()}},GanttMaster.prototype.init=function(t){this.element=t;var e=this;$("#gantEditorTemplates").loadTemplates().remove(),this.editor=new GridEditor(this),t.append(this.editor.gridified),this.gantt=new Ganttalendar("m",(new Date).getTime()-1728e5,(new Date).getTime()+1296e6,this,.6*t.width()),e.splitter=$.splittify.init(t,this.editor.gridified,this.gantt.element,60),e.splitter.firstBoxMinWidth=5,e.splitter.secondBoxMinWidth=20;var n=$.JST.createFromTemplate({},"GANTBUTTONS");e.permissions.canWrite||n.find(".requireCanWrite").hide(),e.permissions.canAdd||n.find(".requireCanAdd").hide(),e.permissions.canInOutdent||n.find(".requireCanInOutdent").hide(),e.permissions.canMoveUpDown||n.find(".requireCanMoveUpDown").hide(),e.permissions.canSeeCriticalPath||n.find(".requireCanSeeCriticalPath").hide(),e.permissions.canAddIssue||n.find(".requireCanAddIssue").hide(),t.before(n),t.bind("refreshTasks.gantt",function(){e.redrawTasks()}).bind("refreshTask.gantt",function(t,n){e.drawTask(n)}).bind("deleteCurrentTask.gantt",function(t){e.deleteCurrentTask()}).bind("addAboveCurrentTask.gantt",function(){e.addAboveCurrentTask()}).bind("addBelowCurrentTask.gantt",function(){e.addBelowCurrentTask()}).bind("indentCurrentTask.gantt",function(){e.indentCurrentTask()}).bind("outdentCurrentTask.gantt",function(){e.outdentCurrentTask()}).bind("moveUpCurrentTask.gantt",function(){e.moveUpCurrentTask()}).bind("moveDownCurrentTask.gantt",function(){e.moveDownCurrentTask()}).bind("collapseAll.gantt",function(){e.collapseAll()}).bind("expandAll.gantt",function(){e.expandAll()}).bind("zoomPlus.gantt",function(){e.gantt.zoomGantt(!0)}).bind("zoomMinus.gantt",function(){e.gantt.zoomGantt(!1)}).bind("addIssue.gantt",function(){e.addIssue()}).bind("undo.gantt",function(){e.permissions.canWrite&&e.undo()}).bind("redo.gantt",function(){e.permissions.canWrite&&e.redo()}).bind("resize.gantt",function(){e.resize()}),$("body").bind("keydown.body",function(t){var n=!0,r=t.ctrlKey||t.metaKey,a=("body"==t.target.nodeName.toLowerCase()||t.target.nodeName.toLowerCase(),$(t.target).closest("#workSpace").length>0),s=$(":focus"),i=e.gantt.element.find(".focused.focused"),o=i.length>0;(a||o)&&r&&37==t.keyCode?(e.outdentCurrentTask(),s.focus()):a&&r&&38==t.keyCode?(e.moveUpCurrentTask(),s.focus()):a&&r&&39==t.keyCode?(e.indentCurrentTask(),s.focus()):a&&r&&40==t.keyCode?(e.moveDownCurrentTask(),s.focus()):r&&89==t.keyCode?e.redo():r&&90==t.keyCode?e.undo():r&&a&&(8==t.keyCode||46==t.keyCode)?e.deleteCurrentTask():!i.is(".taskBox")||8!=t.keyCode&&46!=t.keyCode?!i.is(".linkGroup")||8!=t.keyCode&&46!=t.keyCode?n=!1:e.removeLink(focused.data("from"),focused.data("to")):e.deleteCurrentTask(),n&&(t.preventDefault(),t.stopPropagation())}),$("#saveGanttButton").after($("#LOG_CHANGES_CONTAINER")),this.element.on("gantt.saveRequired",this.manageSaveRequired)},GanttMaster.messages={CANNOT_WRITE:"CANNOT_WRITE",CHANGE_OUT_OF_SCOPE:"NO_RIGHTS_FOR_UPDATE_PARENTS_OUT_OF_EDITOR_SCOPE",START_IS_MILESTONE:"START_IS_MILESTONE",END_IS_MILESTONE:"END_IS_MILESTONE",TASK_HAS_CONSTRAINTS:"TASK_HAS_CONSTRAINTS",GANTT_ERROR_DEPENDS_ON_OPEN_TASK:"GANTT_ERROR_DEPENDS_ON_OPEN_TASK",GANTT_ERROR_DESCENDANT_OF_CLOSED_TASK:"GANTT_ERROR_DESCENDANT_OF_CLOSED_TASK",TASK_HAS_EXTERNAL_DEPS:"TASK_HAS_EXTERNAL_DEPS",GANTT_ERROR_LOADING_DATA_TASK_REMOVED:"GANTT_ERROR_LOADING_DATA_TASK_REMOVED",CIRCULAR_REFERENCE:"CIRCULAR_REFERENCE",CANNOT_MOVE_TASK:"CANNOT_MOVE_TASK",CANNOT_DEPENDS_ON_ANCESTORS:"CANNOT_DEPENDS_ON_ANCESTORS",CANNOT_DEPENDS_ON_DESCENDANTS:"CANNOT_DEPENDS_ON_DESCENDANTS",INVALID_DATE_FORMAT:"INVALID_DATE_FORMAT",GANTT_QUARTER_SHORT:"GANTT_QUARTER_SHORT",GANTT_SEMESTER_SHORT:"GANTT_SEMESTER_SHORT",CANNOT_CLOSE_TASK_IF_OPEN_ISSUE:"CANNOT_CLOSE_TASK_IF_OPEN_ISSUE",PLEASE_SAVE_PROJECT:"PLEASE_SAVE_PROJECT"},GanttMaster.prototype.createTask=function(t,e,n,r,a,s){return(new TaskFactory).build(t,e,n,r,a,s)},GanttMaster.prototype.getOrCreateResource=function(t,e){var n=this.getResource(t);return!n&&t&&e&&(n=this.createResource(t,e)),n},GanttMaster.prototype.createResource=function(t,e){var n=new Resource(t,e);return this.resources.push(n),n},GanttMaster.prototype.updateDependsStrings=function(){for(var t=0;t<this.tasks.length;t++)this.tasks[t].depends="";for(var t=0;t<this.links.length;t++){var e=this.links[t];e.to.depends;e.to.depends=e.to.depends+(""==e.to.depends?"":",")+(e.from.getRow()+1)+(e.lag?":"+e.lag:"")}},GanttMaster.prototype.removeLink=function(t,e){if(this.permissions.canWrite&&(t.canWrite||e.canWrite)){this.beginTransaction();for(var n=!1,r=0;r<this.links.length;r++)if(this.links[r].from==t&&this.links[r].to==e){this.links.splice(r,1),n=!0;break}n&&(this.updateDependsStrings(),this.updateLinks(e)&&this.changeTaskDates(e,e.start,e.end)),this.endTransaction()}},GanttMaster.prototype.removeAllLinks=function(t,e){if(this.permissions.canWrite&&(t.canWrite||t.canWrite)){e&&this.beginTransaction();for(var n=!1,r=0;r<this.links.length;r++)this.links[r].from!=t&&this.links[r].to!=t||(this.links.splice(r,1),n=!0);n&&this.updateDependsStrings(),e&&this.endTransaction()}},GanttMaster.prototype.addTask=function(t,e){if(this.permissions.canWrite&&this.permissions.canAdd){t.master=this;for(var n=-1,r=0;r<this.tasks.length;r++)if(t.id==this.tasks[r].id){n=r;break}n>=0&&(this.tasks.splice(n,1),e=parseInt(n)),"number"!=typeof e?this.tasks.push(t):(this.tasks.splice(e,0,t),this.updateDependsStrings());var a=!this.updateLinks(t);t.getParent()?t.status=t.getParent().status:t.status="STATUS_ACTIVE";var s=t;return a||!t.setPeriod(t.start,t.end)?(this.tasks.splice(t.getRow(),1),s=void 0):(this.editor.addTask(t,e),this.gantt.addTask(t)),$(this.element).trigger("addedTask.gantt",t),s}},GanttMaster.prototype.loadProject=function(t){this.beginTransaction(),this.serverClientTimeOffset=void 0!==t.serverTimeOffset?parseInt(t.serverTimeOffset)+6e4*(new Date).getTimezoneOffset():0,this.resources=t.resources,this.roles=t.roles,this.permissions.canWrite=t.canWrite,this.permissions.canWriteOnParent=t.canWriteOnParent,this.permissions.cannotCloseTaskIfIssueOpen=t.cannotCloseTaskIfIssueOpen,t.minEditableDate?this.minEditableDate=computeStart(t.minEditableDate):this.minEditableDate=-1/0,t.maxEditableDate?this.maxEditableDate=computeEnd(t.maxEditableDate):this.maxEditableDate=1/0;for(var e=this.loadCollapsedTasks(),n=0;n<t.tasks.length;n++){var r=t.tasks[n];r.start+=this.serverClientTimeOffset,r.end+=this.serverClientTimeOffset,r.collapsed=e.indexOf(r.id)>=0}this.loadTasks(t.tasks,t.selectedRow),this.deletedTaskIds=[],t.zoom&&(this.gantt.zoom=t.zoom),this.endTransaction();var a=this;this.gantt.element.oneTime(200,function(){a.gantt.centerOnToday()})},GanttMaster.prototype.loadTasks=function(t,e){var n=new TaskFactory;this.reset();for(var r=0;r<t.length;r++){var a=t[r];if(!(a instanceof Task)){var s=n.build(a.id,a.name,a.code,a.level,a.start,a.duration,a.collapsed);for(var i in a)"end"!=i&&"start"!=i&&(s[i]=a[i]);a=s}a.master=this,this.tasks.push(a)}for(var r=0;r<this.tasks.length;r++){for(var a=this.tasks[r],o=this.__currentTransaction&&this.__currentTransaction.errors?this.__currentTransaction.errors.length:0;!this.updateLinks(a);){if(this.__currentTransaction&&o!=this.__currentTransaction.errors.length){for(var l="ERROR:\n";o<this.__currentTransaction.errors.length;){l=l+this.__currentTransaction.errors.pop().msg+"\n\n"}alert(l)}this.removeAllLinks(a,!1)}a.setPeriod(a.start,a.end)?(this.editor.addTask(a,null,!0),this.gantt.addTask(a)):(alert(GanttMaster.messages.GANNT_ERROR_LOADING_DATA_TASK_REMOVED+"\n"+a.name),this.tasks.splice(a.getRow(),1))}this.tasks&&this.tasks.length>0&&(e=e||0,this.tasks[e].rowElement.click())},GanttMaster.prototype.getTask=function(t){for(var e,n=0;n<this.tasks.length;n++){var r=this.tasks[n];if(r.id==t){e=r;break}}return e},GanttMaster.prototype.getResource=function(t){for(var e,n=0;n<this.resources.length;n++){var r=this.resources[n];if(r.id==t){e=r;break}}return e},GanttMaster.prototype.changeTaskDeps=function(t){return t.moveTo(t.start)},GanttMaster.prototype.changeTaskDates=function(t,e,n){return t.setPeriod(e,n)},GanttMaster.prototype.moveTask=function(t,e){return t.moveTo(e,!0)},GanttMaster.prototype.taskIsChanged=function(){var t=this;this.element.stopTime("gnnttaskIsChanged"),this.element.oneTime(50,"gnnttaskIsChanged",function(){t.editor.redraw(),t.gantt.refreshGantt(),t.element.trigger("gantt.refreshGanttCompleted")})},GanttMaster.prototype.redraw=function(){this.editor.redraw(),this.gantt.refreshGantt()},GanttMaster.prototype.reset=function(){this.tasks=[],this.links=[],this.deletedTaskIds=[],this.__inUndoRedo?this.__inUndoRedo=!1:(this.__undoStack=[],this.__redoStack=[]),delete this.currentTask,this.editor.reset(),this.gantt.reset()},GanttMaster.prototype.showTaskEditor=function(t){this.getTask(t).rowElement.find(".edit").click()},GanttMaster.prototype.saveProject=function(){return this.saveGantt(!1)},GanttMaster.prototype.saveGantt=function(t){for(var e=[],n=0;n<this.tasks.length;n++){var r=this.tasks[n],a=r.clone();delete a.master,delete a.rowElement,delete a.ganttElement,t||(a.start-=this.serverClientTimeOffset,a.end-=this.serverClientTimeOffset),e.push(a)}var s={tasks:e};return this.currentTask&&(s.selectedRow=this.currentTask.getRow()),s.deletedTaskIds=this.deletedTaskIds,t||(s.resources=this.resources,s.roles=this.roles,s.canWrite=this.permissions.canWrite,s.canWriteOnParent=this.permissions.canWriteOnParent,s.zoom=this.gantt.zoom,this.storeCollapsedTasks(),this.markUnChangedTasksAndAssignments(s),s.changesReasonWhy=$("#LOG_CHANGES").val()),s},GanttMaster.prototype.markUnChangedTasksAndAssignments=function(t){if(this.__undoStack.length>0)for(var e=JSON.parse(ge.__undoStack[0]),n=0;n<t.tasks.length;n++){var r=t.tasks[n];if("String"==typeof r.id&&!r.id.startsWith("tmp_")){for(var a,s=0;s<e.tasks.length;s++)if(e.tasks[s].id==r.id){a=e.tasks[s];break}var i=a.id!=r.id||a.code!=r.code||a.name!=r.name||a.start!=r.start||a.startIsMilestone!=r.startIsMilestone||a.end!=r.end||a.endIsMilestone!=r.endIsMilestone||a.duration!=r.duration||a.status!=r.status||a.typeId!=r.typeId||a.relevance!=r.relevance||a.progress!=r.progress||a.progressByWorklog!=r.progressByWorklog||a.description!=r.description||a.level!=r.level||a.depends!=r.depends;if(r.unchanged=!i,r.assigs&&r.assigs.length>0&&a&&a.assigs&&a.assigs.length>0)for(var s=0;s<a.assigs.length;s++){for(var o,l=a.assigs[s],d=0;d<r.assigs.length;d++)if(l.id==r.assigs[d].id){o=r.assigs[d];break}o&&(o.unchanged=o.resourceId==l.resourceId&&o.roleId==l.roleId&&o.effort==l.effort)}}}},GanttMaster.prototype.loadCollapsedTasks=function(){var t=[];if(localStorage)return localStorage.getObject("TWPGanttCollTasks")&&(t=localStorage.getObject("TWPGanttCollTasks")),t},GanttMaster.prototype.storeCollapsedTasks=function(){if(localStorage){var t;t=localStorage.getObject("TWPGanttCollTasks")?localStorage.getObject("TWPGanttCollTasks"):[];for(var e=0;e<this.tasks.length;e++){var n=this.tasks[e],r=t.indexOf(n.id);n.collapsed?r<0&&t.push(n.id):r>=0&&t.splice(r,1)}localStorage.setObject("TWPGanttCollTasks",t)}},GanttMaster.prototype.updateLinks=function(t){function e(t,n,r){if(n==t)return!0;for(var a=t.getSuperiors(),s=t.getParent();s;)a=a.concat(s.getSuperiors()),s=s.getParent();for(var i=t.getChildren(),o=0;o<i.length;o++)a=a.concat(i[o].getSuperiors());for(var l=!1,o=0;o<a.length;o++){var d=a[o];if(d.from==n){l=!0;break}if(r.indexOf(d.from.id+"x"+n.id)<=0&&(r.push(d.from.id+"x"+n.id),e(d.from,n,r))){l=!0;break}}var h=n.getParent();return h&&r.indexOf(t.id+"x"+h.id)<=0&&(r.push(t.id+"x"+h.id),e(t,h,r)&&(l=!0)),l}this.links=this.links.filter(function(e){return e.to!=t});var n=!0;if(t.depends){for(var r=t.getParents(),a=t.getDescendant(),s=t.depends.split(","),i="",o=[],l=0;l<s.length;l++){var d=s[l],h=d.split(":"),u=0;h.length>1&&(u=parseInt(h[1]));var c=this.tasks[parseInt(h[0]-1)];c&&(r&&r.indexOf(c)>=0?(this.setErrorOnTransaction('"'+t.name+'"\n'+GanttMaster.messages.CANNOT_DEPENDS_ON_ANCESTORS+'\n"'+c.name+'"'),n=!1):a&&a.indexOf(c)>=0?(this.setErrorOnTransaction('"'+t.name+'"\n'+GanttMaster.messages.CANNOT_DEPENDS_ON_DESCENDANTS+'\n"'+c.name+'"'),n=!1):e(c,t,o)?(n=!1,this.setErrorOnTransaction(GanttMaster.messages.CIRCULAR_REFERENCE+'\n"'+t.name+'" -> "'+c.name+'"')):(this.links.push(new Link(c,t,u)),i=i+(i.length>0?",":"")+d))}t.depends=i}return n},GanttMaster.prototype.moveUpCurrentTask=function(){var t=this;t.permissions.canWrite&&t.currentTask.canWrite&&t.permissions.canMoveUpDown&&t.currentTask&&(t.beginTransaction(),t.currentTask.moveUp(),t.endTransaction())},GanttMaster.prototype.moveDownCurrentTask=function(){var t=this;t.permissions.canWrite&&t.currentTask.canWrite&&t.permissions.canMoveUpDown&&t.currentTask&&(t.beginTransaction(),t.currentTask.moveDown(),t.endTransaction())},GanttMaster.prototype.outdentCurrentTask=function(){var t=this;if(t.permissions.canWrite&&t.currentTask.canWrite&&t.permissions.canInOutdent&&t.currentTask){var e=t.currentTask.getParent();t.beginTransaction(),t.currentTask.outdent(),t.endTransaction(),e&&t.editor.refreshExpandStatus(e)}},GanttMaster.prototype.indentCurrentTask=function(){var t=this;t.permissions.canWrite&&t.currentTask.canWrite&&t.permissions.canInOutdent&&t.currentTask&&(t.beginTransaction(),t.currentTask.indent(),t.endTransaction())},GanttMaster.prototype.addBelowCurrentTask=function(){var t=this;if(t.permissions.canWrite&&t.permissions.canAdd){var e,n=new TaskFactory,r=0;if(t.currentTask&&t.currentTask.name&&(e=n.build("tmp_"+(new Date).getTime(),"","",t.currentTask.level+1,t.currentTask.start,1),(r=t.currentTask.getRow()+1)>0)){t.beginTransaction();var a=t.addTask(e,r);a&&(a.rowElement.click(),a.rowElement.find("[name=name]").focus()),t.endTransaction()}}},GanttMaster.prototype.addAboveCurrentTask=function(){var t=this;if(t.permissions.canWrite&&t.permissions.canAdd){var e,n=new TaskFactory,r=0;if(t.currentTask&&t.currentTask.name){if(t.currentTask.level<=0)return;if(e=n.build("tmp_"+(new Date).getTime(),"","",t.currentTask.level,t.currentTask.start,1),(r=t.currentTask.getRow())>0){t.beginTransaction();var a=t.addTask(e,r);a&&(a.rowElement.click(),a.rowElement.find("[name=name]").focus()),t.endTransaction()}}}},GanttMaster.prototype.deleteCurrentTask=function(){var t=this;if(t.currentTask&&t.permissions.canWrite&&t.currentTask.canWrite){var e=t.currentTask.getRow();if(t.currentTask&&(e>0||t.isMultiRoot||t.currentTask.isNew())){var n=t.currentTask.getParent();t.beginTransaction(),t.currentTask.deleteTask(),t.currentTask=void 0,t.updateDependsStrings(),t.redraw(),n&&t.editor.refreshExpandStatus(n),e=e>t.tasks.length-1?t.tasks.length-1:e,e>=0&&(t.currentTask=t.tasks[e],t.currentTask.rowElement.click(),t.currentTask.rowElement.find("[name=name]").focus()),t.endTransaction()}}},GanttMaster.prototype.collapseAll=function(){if(this.currentTask){this.currentTask.collapsed=!0;for(var t=this.currentTask.getDescendant(),e=0;e<t.length;e++)t[e].isParent()&&(t[e].collapsed=!0),t[e].rowElement.hide();this.redraw(),this.storeCollapsedTasks()}},GanttMaster.prototype.expandAll=function(){if(this.currentTask){this.currentTask.collapsed=!1;for(var t=this.currentTask.getDescendant(),e=0;e<t.length;e++)t[e].collapsed=!1,t[e].rowElement.show();this.redraw(),this.storeCollapsedTasks()}},GanttMaster.prototype.collapse=function(t,e){console.debug("collapse",t),t.collapsed=!0,t.rowElement.addClass("collapsed");for(var n=t.getDescendant(),r=0;r<n.length;r++)n[r].rowElement.hide();this.gantt.refreshGantt(),this.storeCollapsedTasks()},GanttMaster.prototype.expand=function(t,e){console.debug("expand",t),t.collapsed=!1,t.rowElement.removeClass("collapsed");for(var n=this.getCollapsedDescendant(),r=t.getDescendant(),a=0;a<r.length;a++){var s=r[a];n.indexOf(s)>=0||s.rowElement.show()}this.gantt.refreshGantt(),this.storeCollapsedTasks()},GanttMaster.prototype.getCollapsedDescendant=function(){for(var t=this.tasks,e=[],n=0;n<t.length;n++){var r=t[n];e.indexOf(r)>=0||r.collapsed&&(e=e.concat(r.getDescendant()))}return e},GanttMaster.prototype.addIssue=function(){var t=this;if(t.currentTask.isNew())return void alert(GanttMaster.messages.PLEASE_SAVE_PROJECT);t.currentTask&&t.currentTask.canAddIssue&&openIssueEditorInBlack("0","AD","ISSUE_TASK="+t.currentTask.id)},GanttMaster.prototype.beginTransaction=function(){return this.__currentTransaction?console.error("Cannot open twice a transaction"):this.__currentTransaction={snapshot:JSON.stringify(this.saveGantt(!0)),errors:[]},this.__currentTransaction},GanttMaster.prototype.setErrorOnTransaction=function(t,e){this.__currentTransaction?this.__currentTransaction.errors.push({msg:t,task:e}):console.error(t)},GanttMaster.prototype.isTransactionInError=function(){return this.__currentTransaction?this.__currentTransaction.errors.length>0:(console.error("Transaction never started."),!0)},GanttMaster.prototype.endTransaction=function(){if(!this.__currentTransaction)return console.error("Transaction never started."),!0;var t=!0;if(this.__currentTransaction.errors.length<=0){this.__undoStack.push(this.__currentTransaction.snapshot),this.__redoStack=[],this.gantt.originalStartMillis=1/0,this.gantt.originalEndMillis=-1/0;for(var e=0;e<this.tasks.length;e++){var n=this.tasks[e];this.gantt.originalStartMillis>n.start&&(this.gantt.originalStartMillis=n.start),this.gantt.originalEndMillis<n.end&&(this.gantt.originalEndMillis=n.end)}this.taskIsChanged()}else{t=!1;for(var r="ERROR:\n",e=0;e<this.__currentTransaction.errors.length;e++){r=r+this.__currentTransaction.errors[e].msg+"\n\n"}alert(r);var a=JSON.parse(this.__currentTransaction.snapshot);this.deletedTaskIds=a.deletedTaskIds,this.__inUndoRedo=!0,this.loadTasks(a.tasks,a.selectedRow),this.redraw()}return this.__currentTransaction=void 0,this.saveRequired(),this.editor.refreshExpandStatus(this.currentTask),t},GanttMaster.prototype.checkpoint=function(){this.__undoStack=[],this.__redoStack=[],this.saveRequired()},GanttMaster.prototype.undo=function(){if(this.__undoStack.length>0){var t=this.__undoStack.pop();this.__redoStack.push(JSON.stringify(this.saveGantt()));var e=JSON.parse(t);this.deletedTaskIds=e.deletedTaskIds,this.__inUndoRedo=!0,this.loadTasks(e.tasks,e.selectedRow),this.redraw(),this.saveRequired()}},GanttMaster.prototype.redo=function(){if(this.__redoStack.length>0){var t=this.__redoStack.pop();this.__undoStack.push(JSON.stringify(this.saveGantt()));var e=JSON.parse(t);this.deletedTaskIds=e.deletedTaskIds,this.__inUndoRedo=!0,this.loadTasks(e.tasks,e.selectedRow),this.redraw(),this.saveRequired()}},GanttMaster.prototype.saveRequired=function(){this.__undoStack.length>0&&this.permissions.canWrite?($("#saveGanttButton").removeClass("disabled"),$("form[alertOnChange] #Gantt").val((new Date).getTime()),this.element.trigger("gantt.saveRequired",[!0])):($("#saveGanttButton").addClass("disabled"),$("form[alertOnChange] #Gantt").updateOldValue(),this.element.trigger("gantt.saveRequired",[!1]))},GanttMaster.prototype.resize=function(){this.splitter.resize()},GanttMaster.prototype.computeCriticalPath=function(){function t(e){for(var n=e.earlyFinish,r=e.getInferiorTasks(),a=0;a<r.length;a++){var s=r[a];n>=s.earlyStart&&(s.earlyStart=n,s.earlyFinish=n+s.duration),t(s)}}if(!this.tasks)return!1;for(var e=this.tasks.filter(function(t){return t.getRow()>0&&(!t.isParent()||t.isParent()&&!t.isDependent())}),n=0;n<e.length;n++){var r=e[n];r.earlyStart=-1,r.earlyFinish=-1,r.latestStart=-1,r.latestFinish=-1,r.criticalCost=-1,r.isCritical=!1}for(var a=[],s=e.concat();s.length>0;){for(var i=!1,n=0;n<s.length;n++){var o=s[n],l=o.getInferiorTasks();if(function(t,e){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])<0)return!1;return!0}(a,l)){for(var d=0,h=0;h<l.length;h++){var r=l[h];r.criticalCost>d&&(d=r.criticalCost)}o.criticalCost=d+o.duration,a.push(o),s.splice(n,1),i=!0}}if(!i)return console.error("Cyclic dependency, algorithm stopped!"),!1}!function(t){for(var e=-1,n=0;n<t.length;n++){var r=t[n];r.criticalCost>e&&(e=r.criticalCost)}for(var n=0;n<t.length;n++){var r=t[n];r.setLatest(e)}}(e);var u=function(t){for(var e=[],n=0;n<t.length;n++)t[n].depends&&""!=t[n].depends||e.push(t[n]);return e}(e);return function(e){for(var n=0;n<e.length;n++){var r=e[n];r.earlyStart=0,r.earlyFinish=r.duration,t(r)}}(u),function(t){for(var e=0;e<t.length;e++){var n=t[e];n.isCritical=n.earlyStart==n.latestStart}}(e),e},GanttMaster.prototype.manageSaveRequired=function(t,e){function n(){var t=!1;if(ge.__undoStack.length>0)for(var e=JSON.parse(ge.__undoStack[0]),n=0;!t&&n<ge.tasks.length;n++){var r=ge.tasks[n];if("String"==typeof r.id&&!r.id.startsWith("tmp_")){for(var a,s=0;s<e.tasks.length;s++)if(e.tasks[s].id==r.id){a=e.tasks[s];break}if(a&&(a.status!=r.status||a.start!=r.start||a.end!=r.end)){t=!0;break}}}$("#LOG_CHANGES_CONTAINER").css("display",t?"inline-block":"none")}e?$("body").stopTime("gantt.manageSaveRequired").oneTime(200,"gantt.manageSaveRequired",n):$("#LOG_CHANGES_CONTAINER").hide()};
//# sourceMappingURL=../../maps/virtuoMain_ganttview.min.js.map
